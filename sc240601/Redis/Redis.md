## Redis

### 1. ä»€ä¹ˆæ˜¯nosql(éå…³ç³»å‹æ•°æ®åº“)

> å…¨ç§°not only sql å’Œ ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ç›¸æ¯”mysql oracleï¼Œå®ƒä¸éœ€è¦åˆ›å»ºå…³ç³»æ¨¡å‹(äºŒç»´è¡¨)ï¼Œæ•°æ®å’Œæ•°æ®ä¹‹é—´ä¹Ÿå¯ä»¥æ²¡æœ‰å¿…ç„¶çš„è”ç³»ï¼Œåº•å±‚æ˜¯åŸºäºkey-valueå­˜å‚¨çš„ã€‚è€Œä¸”æ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œå­˜å‚¨çš„ï¼Œæ‰€ä»¥è¯»å†™é€Ÿåº¦è¿œè¿œé«˜äº ä¼ ç»Ÿçš„å…³ç³»å‹æ•°æ®åº“ã€‚

### 2.ä»€ä¹ˆæ˜¯Redis

> redisæ˜¯ä¸€ä¸ªå¼€æºçš„ï¼Œä½¿ç”¨Cè¯­è¨€ç¼–å†™çš„ï¼Œæ”¯æŒç½‘ç»œäº¤äº’ï¼Œå¯ä»¥åŸºäºå†…å­˜å­˜å‚¨ï¼Œä¹Ÿå¯ä»¥æ”¯æŒæŒä¹…åŒ–å­˜å‚¨ï¼Œè¯»å†™é€Ÿåº¦éå¸¸å¿«ï¼Œæ”¯æŒäº‹åŠ¡(æ²¡æœ‰å›æ»š) è¿˜å¯ä»¥è®¾ç½®è¿‡æœŸæ•°æ®ï¼Œéå¸¸é€‚åˆåšç¼“å­˜æ“ä½œã€‚

#### 2.1 redisåº”ç”¨åœºæ™¯

> * ç¼“å­˜æ“ä½œï¼šç¬¬ä¸€æ¬¡æŸ¥è¯¢ä»mysqlä¸­æŸ¥æ•°æ®ï¼Œå¹¶ä¸”å°†æ•°æ®å­˜å‚¨åœ¨redisä¸­ï¼Œå†æ¬¡æŸ¥è¯¢ç›¸åŒçš„æ•°æ®æ—¶èµ°redisä¸èµ°mysql æ•°æ®ï¼Œå¦‚æœæ›´æ–°äº†åˆ™æ¸…ç©ºredisç¼“å­˜ã€‚
> * è®¡ç®—ï¼šç‚¹èµé‡ ä¸‹è½½é‡ è®¿é—®é‡ ...(åŸå­æ€§ï¼Œä¸ä¼šæœ‰å¹¶å‘é—®é¢˜ï¼Œå› ä¸ºredisçš„åº•å±‚æœ‰ä¸€ä¸ªå®ç°è‡ªå¢è‡ªå‡çš„å‘½ä»¤ ä¸“é—¨ç”¨æ¥å®ç°è®¡æ•°ï¼Œè€Œä¸”ä¸ä¼šå‡ºç°å¹¶å‘é—®é¢˜ï¼Œå› ä¸ºä»–ä»¬çš„è‡ªå¢è‡ªå‡å…·æœ‰åŸå­æ€§)
> * æ’è¡Œæ¦œï¼šï¼ˆæ¨èå¸–å­ æ¨èæ¶ˆæ¯ æ¨èå•†å®¶ æ¦œä¸€å¤§å“¥...) å› ä¸ºredisæœ‰ä¸€ä¸ªä¸“é—¨çš„æ•°æ®ç±»å‹ å¯ä»¥è¿›è¡Œæ’åºï¼Œ å¯ä»¥æŠŠå­˜å‚¨çš„æ•°æ®ç»‘å®šä¸€ä¸ªåˆ†æ•°ï¼Œå¯ä»¥æ ¹æ®åˆ†æ•°æ’åº...
> * å¥½å‹å…³ç³»:ï¼ˆå…±åŒçˆ±å¥½ï¼Œå…±åŒå¥½å‹ï¼Œå…±åŒç²‰ä¸...) redisæœ‰ä¸€ä¸ªç±»å‹ ä¸“é—¨å®ç°äº¤é›†å¹¶é›†å·®é›†ï¼Œå¾ˆå®¹æ˜“å®ç° æ•°æ®ä¹‹é—´çš„å…³ç³»
> * sessionå…±äº«ï¼šä»¥ååšäº†é›†ç¾¤ï¼Œæ¯ä¸ªæœåŠ¡å™¨éƒ½ä¼šæœ‰ä¸€ä¸ªsession
> * ç®€å•çš„é˜Ÿåˆ—ï¼šåªèƒ½å®Œæˆä¸€ä¸ªç®€å•çš„é˜Ÿåˆ— å¤æ‚çš„é˜Ÿåˆ— å¯ä»¥äº¤ç»™RabbitMQæ¥å®ç°ã€‚

#### 2.2 redisç¯å¢ƒæ­å»º

> * å®‰è£…redisï¼šä¸ç”¨å®‰è£… è§£å‹å³å¯ä½¿ç”¨ã€‚
>
> * æ‰¾åˆ°redisé…ç½®æ–‡ä»¶`config/redis.conf`
>
> * é…ç½®redisé…ç½®æ–‡ä»¶ `config/redis.conf`
>
>   ```properties
>   #è®¾ç½®ç»‘å®šçš„IPåœ°å€,  å®¢æˆ·ç«¯æ˜¯é€šè¿‡è¿™ä¸ªIPåœ°å€å»é“¾æ¥æœåŠ¡ç«¯çš„
>   bind 192.168.111.111
>   #æŒ‡å®šæ˜¯å¦å¼€å¯ä¿æŠ¤æ¨¡å¼, å¦‚æœå¼€å¯äº†  éœ€è¦è®¿é—®å¯†ç 
>   protected-mode no
>   #ç«¯å£å· å¯ä»¥ä»»æ„å†™ åªè¦ä¿è¯ç«¯å£ä¸å†²çªå³å¯
>   port 6379
>   #è®¾ç½®æ˜¯å¦ä¸ºå®ˆæŠ¤è¿›ç¨‹ , å¦‚æœå¼€å¯rediså¯ä»¥åå°è¿è¡Œ
>   daemonize yes
>   #ä¿å­˜è¿›ç¨‹idçš„ç›®å½•
>   pidfile /var/run/redis_6379.pid
>   #ä¿å­˜æ—¥å¿—çš„ç›®å½•
>   logfile /usr/local/sc240601/redis-5.0.3/log/redis_6379.log
>   #æŒä¹…åŒ–æ–‡ä»¶å
>   dbfilename redis_6379.rdb
>   #æŒä¹…åŒ–æ–‡ä»¶è·¯å¾„
>   dir /usr/local/sc240601/redis-5.0.3/data/
>   ```
>
> * redisæ˜¯åŸºäºC/Sæ¶æ„çš„ é€šè¿‡reidsæœåŠ¡ç«¯å‘½ä»¤å¯åŠ¨redis.
>
>   ```
>   redis-server æŒ‡å®šçš„åŒ…çš„é…ç½®æ–‡ä»¶
>   ```
>
>   * ps -ef | grep redis æŸ¥çœ‹æ˜¯å¦æˆåŠŸï¼Œå¦‚æœå¯åŠ¨å¤±è´¥äº†ï¼ŒæŸ¥çœ‹æ—¥å¿—
>
> * é€šè¿‡rediså®¢æˆ·ç«¯è¿æ¥redisæœåŠ¡ç«¯
>
>   ```
>   redis-cli -h æœåŠ¡ç«¯ipåœ°å€ -p æœåŠ¡å™¨ç«¯å£å·
>   redis-cli -h 192.168.111.111 -p 6379
>
>   -- æµ‹è¯•ç»“æœ
>   ipåœ°å€:ç«¯å£å·>
>   ```
>
> * å†™redisä»£ç 

### 3. RedisåŸºæœ¬å‘½ä»¤

#### 3.0 å¯åŠ¨Redis

> è¦å¯åŠ¨RedisæœåŠ¡å™¨å’Œå®¢æˆ·ç«¯
>
> * å¯åŠ¨RedisæœåŠ¡ç«¯(==æ³¨æ„æ˜¯configç›®å½•ä¸‹çš„config==)[å‡ºç°rediså›¾æ ‡å°±è¡¨ç¤ºå¼€é”™äº†]
>
>   ```
>   redis-server æŒ‡å®šçš„åŒ…çš„é…ç½®æ–‡ä»¶
>   redis-server /usr/local/sc240601/redis-5.0.3/config/redis.conf
>   ```
>
> * å¯åŠ¨Rediså®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯
>
>   ```
>   redis-cli -h æœåŠ¡ç«¯ipåœ°å€ -p æœåŠ¡å™¨ç«¯å£å·
>   redis-cli -h 192.168.111.111 -p 6379
>               
>   -- æˆåŠŸç»“æœ
>   ipåœ°å€:ç«¯å£å·>
>   ```
>

#### 3.1 é€šç”¨å‘½ä»¤

> æ— è®ºä»€ä¹ˆç±»å‹ éƒ½å¯ä»¥ä½¿ç”¨çš„å‘½ä»¤
>
> ```
> keys æ­£åˆ™ï¼šæŸ¥çœ‹ç¬¦åˆæ¡ä»¶çš„keyï¼ˆæŸ¥çœ‹æœ‰å‡ æ¡æ•°æ®ï¼‰
> select æ•°å­—:åˆ‡æ¢æ•°æ®åº“ redisé»˜è®¤åˆ›å»º16ä¸ªæ•°æ®åº“ é€šè¿‡0-15è¿›è¡Œåˆ‡æ¢ï¼Œé»˜è®¤ä¸º0
> type key:æŸ¥çœ‹keyçš„ç±»å‹
> dbsize:æŸ¥çœ‹æ•°æ®åº“ä¸­keyçš„æ•°æ®
> exists key:æŸ¥çœ‹keyæ˜¯å¦å­˜åœ¨ è¿”å›1/0 redisæ²¡æœ‰trueå’Œfalse
> del key:æ ¹æ®keyæ¥åˆ é™¤æ•°æ®
> 
> 
> rename oldkey newkey: ç”¨æ¥ç»™keyé‡å‘½åçš„å¦‚æœnewkeyå·²ç»å­˜åœ¨äº†ï¼Œä¼šæ›¿æ¢æ‰åŸæ¥çš„å€¼ï¼Œå¯èƒ½ä¼šå‡ºç°æ•°æ®ä¸¢å¤±
> renamenx oldkey newkeyï¼šç»™keyé‡å‘½åï¼Œnewkeyä¸å­˜åœ¨æ—¶ï¼Œæ‰èƒ½é‡å‘½å(æ³¨æ„æ˜¯nx)
> expire key ç§’ï¼šè®¾ç½®keyå¤šå°‘ç§’å¤±æ•ˆã€‚ï¼ˆå¯ä»¥ç”¨æ¥åšéªŒè¯ç ï¼‰
> pexpire key æ¯«ç§’ï¼šè®¾ç½®keyå¤šå°‘æ¯«ç§’å¤±æ•ˆã€‚
> ttl keyï¼šæŸ¥çœ‹keyçš„å‰©ä½™æ—¶é—´ï¼Œå¦‚æœè¿”å›-1è¡¨ç¤ºæ²¡æœ‰è®¾ç½®è¿‡è¿‡æœŸæ—¶é—´ä¼šä¸€ç›´å­˜åœ¨ï¼Œè¿”å›-2åˆ™è¡¨ç¤ºè¯¥äº‹ä»¶ä¸å­˜åœ¨ã€‚ğŸ™…â€
> persist keyï¼šå–æ¶ˆè¿‡æœŸæ—¶é—´ï¼Œè½¬å˜ä¸ºæ°¸ä¹…å­˜åœ¨ï¼ˆè¿‡æœŸå°±æ˜¯è¢«åˆ é™¤äº†ï¼‰
> flushdbï¼šæ¸…ç©ºredis æ…ç”¨ğŸˆ²
> ```

#### ==3.2 redisçš„åŸºæœ¬æ•°æ®ç±»å‹==

> * Stringï¼šæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶ç±»å‹ï¼Œå¯ä»¥å­˜å‚¨å­—ç¬¦ä¸²ï¼Œå›¾ç‰‡ï¼Œè§†é¢‘ï¼ŒéŸ³é¢‘ï¼Œä¹Ÿå¯ä»¥å­˜å‚¨ä¸€äº›é™æ€èµ„æºçš„æ–‡ä»¶(æ¯”å¦‚ï¼šjs css ...) Stringç±»å‹çš„æ¯ä¸ªvalueæœ€å¤§å€¼æ˜¯ 512M
>   * ä»€ä¹ˆåœºæ™¯é€‚åˆä½¿ç”¨Stringï¼Ÿ
>     * åšç¼“å­˜
>     * è®¡æ•°åŠŸèƒ½(ç‚¹èµ)ï¼šStringç±»å‹ä¸­æœ‰è‡ªå¢è‡ªå‡çš„åŸå­æ€§æ“ä½œã€‚
> * Listï¼šæ˜¯ä¸€ä¸ªåˆ—è¡¨ç±»å‹ï¼Œåº•å±‚æ˜¯åŒå‘é“¾è¡¨ç»“æ„ï¼Œç±»ä¼¼äºjavaä¸­çš„LinkedListï¼Œæ˜¯ä¸€ä¸ªæœ‰åºçš„å¯ä»¥é‡å¤çš„é›†åˆ
>   * ä»€ä¹ˆåœºæ™¯é€‚åˆä½¿ç”¨List?
>     * é€‚åˆåšç®€å•çš„é˜Ÿåˆ—ï¼ˆæœ‰åºï¼šå¯å®ç°å…ˆè¿›å…ˆå‡ºï¼Œå…ˆè¿›åå‡ºï¼‰
> * Setï¼šæ˜¯ä¸€ä¸ªæ— åºä¸é‡å¤é›†åˆç±»å‹ï¼Œåº•å±‚æ˜¯é€šè¿‡hashtableå®ç°çš„ï¼ŒæŸ¥çœ‹å…ƒç´ å’Œåˆ é™¤å…ƒç´ éƒ½ç‰¹åˆ«å¿«ï¼Œå¯ä»¥é€šè¿‡å®ƒè®°å½•ä¸€äº›ä¸é‡å¤çš„æ•°æ®
>   * ä»€ä¹ˆåœºæ™¯é€‚åˆä½¿ç”¨List?
>     * å…±åŒçˆ±å¥½ï¼Œå…±åŒå¥½å‹ï¼Œç²‰ä¸ï¼šæœ‰ä¸€ä¸ªå®ç°äº¤é›†å¹¶é›†å·®é›†
>     * ç‚¹åï¼ŒæŠ½å¥–åŠŸèƒ½ï¼šæœ‰ä¸€ä¸ªå‘½ä»¤ï¼Œå¯ä»¥è®¾è®¡è·å–é›†åˆä¸­çš„å…ƒç´ 
>       (srandmember + srem æˆ–è€… spop)
> * Sorted Setï¼šå¯èƒ½è¢«å«ä¸ºZsetï¼Œæ˜¯ä¸€ä¸ªæ’åºä¸é‡å¤é›†åˆç±»å‹ï¼Œå…ƒç´ æ˜¯å”¯ä¸€çš„ï¼Œåªä¸è¿‡åº•å±‚æ˜¯é€šè¿‡æ¯ä¸ªå…ƒç´ ä¼šç»‘å®šä¸€ä¸ªdoubleç±»å‹åˆ†æ•°ï¼Œredisé€šè¿‡åˆ†æ•°å¯¹é›†åˆçš„å…ƒç´ è¿›è¡Œå‡åº/é™åºæ’åºï¼Œé›†åˆå…ƒç´ æ˜¯å”¯ä¸€çš„ ä½†æ˜¯åˆ†æ•°æ˜¯å¯ä»¥é‡å¤çš„ã€‚
>   * ä»€ä¹ˆåœºæ™¯é€‚åˆä½¿ç”¨Zset?
>     * æ’è¡Œæ¦œç›¸å…³åº”ç”¨ï¼šè¿™ä¸ªç±»å‹ä¼šè‡ªåŠ¨æ ¹æ®åˆ†æ•°è¿›è¡Œæ’åºï¼ŒæŠŠé›†åˆçš„å…ƒç´ å­˜å‚¨ç”¨æˆ·ä¿¡æ¯ï¼Œåˆ†æ•°è¡¨ç¤ºè¿åŠ¨æ­¥æ•°ï¼Œå°±èƒ½å®ç°è¿åŠ¨æ’åã€‚
> * Hashï¼š mapå¥—mapï¼Œå°±æ˜¯æ¯ä¸ªkeyéƒ½ä¼šå¯¹åº”ä¸€ä¸ªhashtableï¼Œé€‚åˆç”¨æ¥å­˜å‚¨å¯¹è±¡æ•°æ®ã€‚
>   * ä»€ä¹ˆåœºæ™¯é€‚åˆä½¿ç”¨Hash?
>     * é€‚åˆå­˜å‚¨å¯¹è±¡æ•°æ®ï¼Œæ¯”å¦‚ï¼škeyå¯¹åº”ç”¨æˆ·idï¼Œvalueå¯¹åº”ç”¨æˆ·å±æ€§é›†åˆ

#### ==3.3 Stringç±»å‹çš„å‘½ä»¤==

> è¿™é‡Œçš„å‘½ä»¤ å’Œ Javaä¸­æ“ä½œredisçš„æ–¹æ³•å¯¹åº”

```properties
set key value: æ·»åŠ ä¸€ç»„å€¼ å¦‚æœkeyå­˜åœ¨ä¼šè¿›è¡Œæ›¿æ¢
setnx key value: æ·»åŠ ä¸€ç»„å€¼ keyä¸å­˜åœ¨ æ‰å¯ä»¥è®¾ç½®
get key: æ ¹æ®keyè·å–å€¼
mset k1 v1 k2 v2 ... : ä¸€æ¬¡æ€§å­˜å‚¨å¾ˆå¤šç»„å€¼ è¿™ç§æ“ä½œå…·æœ‰åŸå­æ€§ï¼Œè¦ä¹ˆåŒæ—¶æˆåŠŸï¼Œè¦ä¹ˆåŒæ—¶å¤±è´¥
mget k1 k2 k3 ... : ä¸€æ¬¡æ€§è·å–å¾ˆå¤šå€¼

#ä»¥ä¸‹å››ä¸ªå‘½ä»¤ä¹Ÿæ˜¯å®ç°,redisè®¡æ•°åŠŸèƒ½(ç‚¹èµæ•° ä¸‹è½½é‡...)ï¼Œè€Œä¸” ä»–ä»¬ä¸ä¼šæœ‰å¤šçº¿ç¨‹çš„å¹¶å‘é—®é¢˜ å®ƒä»¬å…·æœ‰åŸå­æ€§
incr key: å¯¹keyçš„å€¼è¿›è¡Œè‡ªå¢(å€¼éœ€è¦æ˜¯æ•´å‹çš„)
incrby key æ•°å­—: å¯¹keyçš„å€¼è¿›è¡Œè‡ªå¢æŒ‡å®šçš„æ•°å­—
decr key: è‡ªå‡
decrby key æ•°å­—: è‡ªå‡æŒ‡å®šæ•°å­—

append key æ•°æ®:ç»™æŒ‡å®šçš„keyçš„å€¼è¿½åŠ æ–°å†…å®¹ å¦‚æœkeyä¸å­˜åœ¨ ä¼šå¸®ä½ åˆ›å»ºè¿™ä¸ªkey
strlen key: è·å–é•¿åº¦
getrange key startIndex endIndex: è·å–keyæŒ‡å®šèŒƒå›´çš„æ•°æ®ï¼ˆç±»ä¼¼äºæˆªå–å­—ç¬¦ä¸²ï¼‰[ä¸‹æ ‡ä»0å¼€å§‹]
setrange key index valueï¼šå°†å¯¹åº”ä½ç½®çš„å€¼æ›¿æ¢ä¸ºvalue(ç±»ä¼¼äºæ›¿æ¢å­—ç¬¦ä¸²)[ä¸‹æ ‡ä»0å¼€å§‹]
```

#### 3.4 Listç±»å‹å‘½ä»¤

```properties
#å­˜å€¼
lpush key v1 v2 v3 ...: åœ¨é›†åˆkeyçš„å·¦è¾¹ä¾æ¬¡æ’å…¥ä¸åŒçš„value[...v3 v2 v1]
rpush key v1 v2 v3 ...: åœ¨é›†åˆkeyçš„å³è¾¹ä¾æ¬¡æ’å…¥ä¸åŒçš„value[v1 v2 v3 ...]

#æŸ¥çœ‹
lrange key beginIndex endIndex : è·å–é›†åˆä¸­begin-endèŒƒå›´çš„å…ƒç´ ï¼Œå¦‚æœendæ˜¯-1è¡¨ç¤ºè·å–å…¨éƒ¨å†…å®¹ï¼Œ-2è¡¨ç¤º								   è·å–åˆ° å€’æ•°ç¬¬äºŒä¸ªå…ƒç´ ...
lrange key 0-1 è·å–é›†åˆå…¨éƒ¨å†…å®¹
lindex key index: æ ¹æ®é›†åˆçš„ä¸‹æ ‡(ä»0å¼€å§‹)è·å–å…ƒç´ 
llen key : è·å–é›†åˆçš„é•¿åº¦

#å–å‡ºå¹¶ç§»é™¤å…ƒç´ 
lpop key : å–å‡ºå¹¶ç§»é™¤é›†åˆä¸­çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
rpop key : å–å‡ºå¹¶ç§»é™¤é›†åˆä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ 

lrem key æ•°å­— value: åˆ é™¤é›†åˆä¸­ï¼ŒæŒ‡å®šä¸ªæ•°çš„ï¼ŒæŒ‡å®švalueæ•°æ®
	å¦‚æœæ•°å­—æ˜¯æ­£æ•° ä»å¤´0å¼€å§‹åˆ é™¤å¤šå°‘ä¸ª
	å¦‚æœæ•°å­—æ˜¯è´Ÿæ•° ä»å°¾å¼€å§‹åˆ é™¤å¤šå°‘ä¸ª
	æ•°å­—æ˜¯0 åˆ™å…¨éƒ¨åˆ é™¤

```

#### 3.5 Setæ•°æ®ç±»å‹

```properties
sadd key v1 v2 v3: å‘é›†åˆä¸­å­˜å‚¨å¤šä¸ªä¸é‡å¤çš„æ•°æ®(ä¼šè‡ªåŠ¨å»é‡)
smembers key: æ— åºè·å–é›†åˆä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚ï¼ˆåªèƒ½å–å…¨éƒ¨å…ƒç´ ï¼‰

srandmenber key: éšæœºè·å–é›†åˆä¸­çš„å…ƒç´ ã€‚ï¼ˆåšç‚¹åå’ŒæŠ½å¥–ï¼‰
srandmenber key 2: éšæœºè·å–é›†åˆä¸­ä¸¤ä¸ªçš„å…ƒç´ 

scard key: è·å–é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°
srem key value: åˆ é™¤é›†åˆä¸­æŒ‡å®šçš„å…ƒç´ 
spop key (ä¸ªæ•°): éšæœºè·å–å’Œåˆ é™¤é›†åˆä¸­çš„å…ƒç´ ï¼ˆæŠ½å¥– + ç‚¹åï¼‰

åˆ é™¤æ•´ä¸ªlistå’Œsetä½¿ç”¨ del

#é›†åˆè¿ç®—,äº¤é›†å¹¶é›†å·®é›†å…±åŒç‰¹æ€§(å¥½å‹ç²‰ä¸ çˆ±å¥½ æ¸¸æˆ...)
sunion key1 key2 key3 ...: å¹¶é›† å°†å¤šä¸ªé›†åˆå…ƒç´ åˆå¹¶å–å‡ºæ¥ ç›¸åŒåªå–ä¸€ä¸ª
sdiff key1 key2 key3 ...: å·®é›† è·å–ç¬¬ä¸€ä¸ªé›†åˆ å’Œåé¢çš„é›†åˆä¸åŒçš„å…ƒç´ 
sinter key1 key2 key3 ...: äº¤é›† è·å–å¤šä¸ªé›†åˆå…±åŒçš„å…ƒç´ 

sinterstore newKey key1 key2 ...: è·å–åé¢å¤šä¸ªé›†åˆå…±åŒçš„å…ƒç´  å­˜å…¥æ–°é›†åˆ
sdiffstore newKey key1 key2 ...: è·å–key1é›†åˆå’Œåé¢çš„é›†åˆ ä¸åŒçš„å…ƒç´  å­˜å…¥åˆ°æ–°é›†åˆ
sinterstore newKey key1 key2 ...: è·å–è·å–å¤šä¸ªé›†åˆå…±åŒçš„å…ƒç´  å­˜å…¥åˆ°æ–°é›†åˆ
```



#### 3.6 æœ‰åºé›†åˆSorted Set (Zset)

> sorted set ç±»ä¼¼äºset å…ƒç´ éƒ½æ˜¯å”¯ä¸€çš„ï¼Œåº•å±‚ä¼šä¸ºæ¯ä¸€ä¸ªå…ƒç´ ç»‘å®šä¸€ä¸ªdoubleç±»å‹çš„åˆ†æ•° redisé€šè¿‡åˆ†æ•°è¿›è¡Œæ’åºï¼ˆå‡åº é™åºéƒ½å¯ä»¥ï¼‰ã€‚
> éå¸¸é€‚åˆåšæ’è¡Œæ¦œåŠŸèƒ½ã€‚
> å¦‚æœä½¿ç”¨mysqlæ¥åšæ’åºï¼Œä¸€æ˜¯è¦è¡¨å…³è”æŸ¥è¯¢ï¼ŒäºŒæ˜¯è¦åå¤æŸ¥è¯¢(åœ¨é«˜å¹¶å‘çš„æƒ…å†µä¸‹æ•ˆç‡æ˜¯éå¸¸ä½çš„)ã€‚

```properties
zadd key åˆ†æ•° æ•°æ®: å‘é›†åˆä¸­æ·»åŠ ä¸€ä¸ªå…ƒç´ å¹¶ä¸ºå…¶ç»‘å®šä¸ºä¸€ä¸ªåˆ†æ•° é»˜è®¤æŒ‰ç…§åˆ†æ•°å‡åºæ’åº
#å¦‚ zdd key 1 a
zrange key start end: è·å–æŒ‡å®šèŒƒå›´çš„å…ƒç´  é»˜è®¤æŒ‰ç…§å‡åºè¿”å› ï¼ˆendä¸º-1å°±æ˜¯åˆ°æœ€åä¸€ä¸ªï¼‰ï¼ˆendä¸º-2å°±æ˜¯åˆ°å€’æ•°ç¬¬äºŒä¸ªï¼‰
zrevrange key start end: åŠŸèƒ½å’Œä¸Šé¢ä¸€æ ·ï¼Œåªä¸è¿‡æ˜¯é™åºæ’åˆ—ã€‚(reverseåè½¬)
zincrby key æ•°å­— æ•°æ®: ç»™é›†åˆä¸­çš„æ•°æ®å¯¹åº”çš„åˆ†æ•°è‡ªå¢å¤šå°‘ï¼ˆæ³¨æ„æ˜¯ç»™åˆ†æ•°å¢åŠ ï¼‰ï¼ˆè®¾ç½®è´Ÿæ•°å°±æ˜¯è‡ªå‡ï¼‰
zcount key min max: è·å–åˆ†æ•°åœ¨æŒ‡å®šèŒƒå›´çš„ä¸ªæ•°
zscore key æ•°æ®: è·å–é›†åˆä¸­æ•°æ®å¯¹åº”çš„åˆ†æ•°
zrem key æ•°æ®: ç§»é™¤é›†åˆæŒ‡å®šå…ƒç´ çš„æ•°æ®
zcard key: è·å–é›†åˆä¸­å…ƒç´ çš„ä¸ªæ•°
```



#### 3.7 Hashæ•°æ®ç±»å‹

> hashç±»å‹å°±æ˜¯æ¯ä¸ªkey éƒ½ä¼šå¯¹åº”ä¸€ä¸ªhashtable æ¯”è¾ƒé€‚åˆå­˜å‚¨å¯¹è±¡æ•°æ®
>
> æ¯”å¦‚ï¼škeyå¯¹åº”ç”¨æˆ·id      å…¶ä»–ä¿¡æ¯(k å¯¹åº”å±æ€§å v å¯¹åº”å±æ€§å€¼)
>
> ```
> å›é¡¾ï¼šå„ç§æ•°æ®ç±»å‹å¢åŠ å…ƒç´ çš„å‘½ä»¤ï¼š
> set k v
> lpush list v æˆ– rpush list v
> sadd set v
> zadd zset score k
> hset å¯¹è±¡ k v k2 v2
> ```
>
> ```
> hset hashkey key value: hashkeyå¯ä»¥å½“æˆå¯¹è±¡å keyå¯ä»¥å½“æˆå±æ€§å valueå¯ä»¥å½“æˆå±æ€§å€¼
> 	User u = new User(); hashkeyå¯ä»¥å½“æˆå¯¹è±¡åu
> 	u.å±æ€§å === å±æ€§å€¼;   keyå¯ä»¥å½“æˆå±æ€§åï¼Œvalueå¯ä»¥å½“æˆå±æ€§å€¼
> 
> hmset hashkey k v k2 v2 k3 v3 ...: å‘å¯¹è±¡ä¸­å­˜å‚¨å¾ˆå¤šç»„çš„å±æ€§å€¼
> hget hashkey key : è·å–å¯¹è±¡ä¸­æŒ‡å®šå±æ€§çš„å€¼ã€‚
> hgetall hashkey : è·å–å¯¹è±¡ä¸­çš„å±æ€§å’Œå€¼
> hkeys hashkey: è·å–å¯¹è±¡ä¸­æ‰€æœ‰çš„å±æ€§å
> hvals hashkey: è·å–å¯¹è±¡ä¸­æ‰€æœ‰çš„å±æ€§å€¼
> ```

### ==4. redisçš„æŒä¹…åŒ–æ–¹å¼==

> æŒä¹…åŒ–å°±æ˜¯æŠŠå†…å­˜ä¸­çš„æ•°æ®å­˜å‚¨åˆ°ç£ç›˜ä¸­å»ã€‚

#### 4.1 RDBæ¨¡å¼

> RDBæ¨¡å¼ä¹Ÿå«åŠæŒä¹…åŒ–æ¨¡å¼ï¼Œå®é™…æ“ä½œredisæœåŠ¡ç«¯ æ¯éš”ä¸€æ®µå®é™… ä¼šç”Ÿæˆä¸€ä¸ªå­è¿›ç¨‹ é€šè¿‡å­è¿›ç¨‹è´Ÿè´£å°†æ•°æ®å†™å…¥åˆ°ä¸´æ—¶æ–‡ä»¶ï¼Œç­‰å¾…å†™å…¥æˆåŠŸåå†å»æå–ä¹‹å‰ä¿ç•™çš„æ–‡ä»¶ã€‚
>
> * ä¼˜ç‚¹ï¼š
>   * å¦‚æœä½¿ç”¨RDBæ¨¡å¼ redisåªéœ€è¦ä¿å­˜ä¸€ä¸ªrdbæ–‡ä»¶å³å¯ å¯¹äºä»¥åæ•°æ®çš„å¤‡ä»½å’Œè¿˜åŸéƒ½æ˜¯æ¯”è¾ƒå®Œç¾çš„ï¼Œå¦‚æœå‡ºç°å®•æœºå¾ˆå®¹æ˜“å°±å¯ä»¥æ¢å¤æ•°æ®ã€‚
>   * RDBæ¨¡å¼æ˜¯é€šè¿‡å­è¿›ç¨‹è¿›è¡Œæ•°æ®çš„æŒä¹…åŒ–ï¼Œä¸ä¼šå½±å“redisæœåŠ¡ç«¯ä¸»è¿›ç¨‹çš„è¯»å†™ï¼Œæ‰€ä»¥å…¶æ‰§è¡Œæ•ˆç‡æ˜¯æ¯”è¾ƒé«˜çš„ã€‚
> * ç¼ºç‚¹ï¼š
>   * `å®¹æ˜“å‡ºç°æ•°æ®ä¸¢å¤±`ï¼Œå› ä¸ºåº•å±‚æ˜¯é€šè¿‡å­è¿›ç¨‹ï¼Œæ¯éš”ä¸€æ®µæ—¶é—´ï¼Œè¿›è¡Œæ•°æ®æŒä¹…åŒ–ï¼Œä¸‡ä¸€åœ¨è¿™æ®µæ—¶é—´ä¹‹å†…ï¼Œrediså®•æœºäº†ï¼Œé‚£ä¹ˆè¿™æ®µæ—¶é—´ä¹‹å†…å†™å…¥çš„æ•°æ®å°±ä¸¢å¤±äº†ã€‚
>   * ä¸´æ—¶æ–‡ä»¶åªæœ‰ä¸€ä¸ªï¼Œä¸‡ä¸€ä¸´æ—¶æ–‡ä»¶æŸåï¼Œå°±æ— æ³•æ¢å¤æ•°æ®äº†ã€‚
>
> ![img](D:\Desktop\gitee\java-learning\sc240601\Linux\img\Redisçš„æŒä¹…åŒ–-RDBæ¨¡å¼.png)

#### 4.2 AOFæ¨¡å¼

> AOFæ¨¡å¼ä¹Ÿå«åšå…¨æŒä¹…åŒ–æ¨¡å¼(å†™ä¸€æ¬¡å°±å­˜å‚¨ä¸€æ¬¡ï¼Œä¸åƒRDBæ˜¯éš”ä¸€æ®µæ—¶é—´å­˜ä¸€æ¬¡)ï¼Œåº•å±‚æ˜¯é€šè¿‡æ—¥å¿—å½¢å¼å»è®°å½•redisæœåŠ¡ç«¯æ‰€æ‰§è¡Œçš„å‘½ä»¤(åªä¼šè®°å½•å¢set åˆ del æ”¹çš„å‘½ä»¤ï¼Œåƒget mget è¿™äº›æŸ¥è¯¢å‘½ä»¤å°±ä¸ä¼šè®°å½•)ã€‚
> å¦‚æœåæœŸrediså®•æœºäº†ï¼ŒåæœŸåšç¾éš¾æ¢å¤æ—¶ï¼Œåªéœ€è¦é‡æ–°æ‰§è¡Œä¸€éè®°å½•è¿™äº›çš„å‘½ä»¤å³å¯
>
> * ä¼˜ç‚¹ï¼š
>   * å¦‚æœé‡‡ç”¨AOFæ¨¡å¼ï¼Œå…·æœ‰æ›´é«˜çš„æ•°æ®å®‰å…¨æ€§ï¼Œå› ä¸ºredisæœ‰ä»–è‡ªå·±çš„åŒæ­¥ç­–ç•¥(æ¯ç§’åŒæ­¥ æ¯ä¿®æ”¹åŒæ­¥ ä¸åŒæ­¥)å¦‚æœè®¾ç½®æˆæ¯ä¿®æ”¹åŒæ­¥ï¼Œæ¯æ¬¡ä¿®æ”¹åéƒ½ä¼šé€šè¿‡æ—¥å¿—è®°å½•ä¸‹æ¥ï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°æ•°æ®ä¸¢å¤±äº†ã€‚
>   * ç”±äºAOFæ¨¡å¼ æ˜¯é€šè¿‡æ—¥å¿—è®°å½•çš„ï¼Œåº•å±‚æ˜¯é€šè¿‡è¿½åŠ æ¨¡å¼ï¼Œæ¯æ¬¡å†™å…¥æ–°çš„æ•°æ®å°±ä¼šè¿›è¡Œè¿½åŠ ï¼Œä¸ä¼šæŸåä¹‹å‰å­˜å‚¨çš„æ—¥å¿—ä¿¡æ¯ã€‚
> * ç¼ºç‚¹ï¼š
>   * æ¯ä¸€æ¬¡å†™å…¥éƒ½éœ€è¦è®°å½•æ‰§è¡Œçš„å‘½ä»¤ï¼Œå¹¶å‘é‡ç‰¹åˆ«é«˜æ—¶ï¼Œå°±ä¼šå½±å“åˆ°redisæœåŠ¡ç«¯æ‰§è¡Œçš„é€Ÿåº¦ï¼Œä¼šé™ä½æ‰§è¡Œæ•ˆç‡ã€‚
>   * AOFæ¨¡å¼ä¿å­˜çš„æ—¥å¿—å½¢å¼çš„æ–‡ä»¶ï¼Œå¯èƒ½ä¼šå‡ºç°å¾ˆå¤šä¸ªï¼Œæ‰€ä»¥è¦æ¢å¤æ•°æ®æ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºæ¯ä¸ªæ–‡ä»¶éƒ½éœ€è¦æ¢å¤ï¼Œæ•°æ®é‡ç‰¹åˆ«å¤§ æ¢å¤æ•°æ®æ˜¯å¾ˆéº»çƒ¦çš„ã€‚

> å¼€å‘æŒ‰éœ€æ±‚æ¥é€‰ç”¨æŒä¹…åŒ–æ–¹å¼ï¼Œä½†æ˜¯æˆ‘ä»¬ä½¿ç”¨reidså°±æ˜¯ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæ‰€ä»¥é»˜è®¤æ˜¯ä½¿ç”¨RDBæ¨¡å¼ã€‚

### 5. redisçš„ä¸»ä»æ¨¡å¼ï¼ˆmaster/slave)

> ä¸»ä»æ¨¡å¼ä¹Ÿå«ä¸»ä»å¤åˆ¶ä¹Ÿå«è¯»å†™åˆ†ç¦»ï¼Œè¡¨ç¤ºæœ‰ä¸€å°ä¸»æœåŠ¡å™¨(ä¸»è¦è´Ÿè´£å†™å…¥) å’Œ å¤šå°ä»æœåŠ¡å™¨(åªèƒ½è¯»å– ä¸èƒ½å†™å…¥ å…·æœ‰ä¸»æœåŠ¡å™¨çš„å¤‡ä»½ï¼‰ã€‚
>
> * ç¼ºç‚¹: å¦‚æœä»æœåŠ¡å™¨å®•æœºäº† æ²¡æœ‰ä»»ä½•å½±å“
>   å¦‚æœä¸»æœåŠ¡å™¨å®•æœºäº† æ•°æ®è™½ç„¶ä¸ä¼šä¸¢å¤± ä½†æ˜¯ä¸èƒ½å†™å…¥äº†
>   éœ€è¦äººå·¥ä»‹å…¥ å°†ä»æœåŠ¡å™¨å‡ä¸ºä¸»æœåŠ¡å™¨ æ‰å¯ä»¥å†æ¬¡å†™å…¥

#### 5.1 æ­å»ºæµç¨‹

> - åˆ›å»ºmastersalveåŒ…  å¤åˆ¶äº†ä¸‰ä»½redis.confé…ç½®æ–‡ä»¶ è¦æ­å»ºä¸€ä¸»ä¸¤ä» 
> - ç¼–è¾‘é‡Œé¢çš„é…ç½®æ–‡ä»¶(ipåœ°å€ ç«¯å£å· è¿›ç¨‹æ–‡ä»¶å æ—¥å¿—æ–‡ä»¶ æŒä¹…åŒ–æ–‡ä»¶å)
> - å¦‚æœæ˜¯ä»æœåŠ¡å™¨ éœ€è¦æ·»åŠ ä¸€ä¸ªé¢å¤–é…ç½®  (å…³è”ä¸»æœåŠ¡å™¨)
>   - replicaof  ä¸»æœåŠ¡å™¨ipåœ°å€   ä¸»æœåŠ¡å™¨ç«¯å£å·
> - é€šè¿‡redis-serverå¯åŠ¨ä¸‰å°redisæœåŠ¡å™¨  
> - é€šè¿‡redis-cli è¿æ¥redisæœåŠ¡ç«¯  è¾“å…¥ info replicationæŸ¥çœ‹ä¸»ä»ä¿¡æ¯
>   - redis-cli -h  ipåœ°å€  -p ç«¯å£
>     - info replication
>
> ![image-20240910172219204](D:\AppData\Typora\typora-user-images\image-20240910172219204.png)
>
> ![image-20240910172755667](D:\AppData\Typora\typora-user-images\image-20240910172755667.png)
>
> ![image-20240910173511457](D:\AppData\Typora\typora-user-images\image-20240910173511457.png)
>
> ![image-20240910173837925](D:\AppData\Typora\typora-user-images\image-20240910173837925.png)
>
> ![image-20240910174238642](D:\AppData\Typora\typora-user-images\image-20240910174238642.png)
>
> ![image-20240910174251127](D:\AppData\Typora\typora-user-images\image-20240910174251127.png)

#### 5.2 ä¸»å’Œä»æœåŠ¡å™¨çš„åˆ‡æ¢

> * å‘½ä»¤1ï¼šå°†ä»æœåŠ¡å™¨ç›´æ¥å‡ä¸ºä¸»æœåŠ¡å™¨ï¼Œå‰ææ˜¯éœ€è¦å…ˆäººåŠ›ä»‹å…¥
>
>   ```
>   slaveof no one
>   ```
>
> * å‘½ä»¤2ï¼šåˆ‡æ¢æˆ‘çš„ä¸»æœåŠ¡å™¨ä¸ºå…¶ä»–æœåŠ¡å™¨ï¼Œé€šè¿‡å…¶ä»–æœåŠ¡å™¨æŒ‡å®šå¥½çš„ä¸»æœåŠ¡å™¨ å‰ææ˜¯éœ€è¦å…ˆäººåŠ›ä»‹å…¥
>
>   ```
>   slaveof æ–°çš„ä¸»æœåŠ¡å™¨ip æ–°çš„ä¸»æœåŠ¡å™¨ç«¯å£
>   ```
>

#### 5.3 ä¸»ä»æ¨¡å¼çš„ç¼ºç‚¹

> å› ä¸ºä¸»ä»æ¨¡å¼å¯ä»¥æé«˜redisçš„æ•°æ®å®‰å…¨æ€§ï¼Œä½†æ˜¯å¦‚æœä¸»æœåŠ¡å™¨å®•æœºï¼Œéœ€è¦å¦‚æœä»‹å…¥æ¥è¾“å…¥å‘½ä»¤(slaveof no one...) å°†ä»æœåŠ¡å™¨å‡çº§ä¸ºä¸»æœåŠ¡å™¨ è¿™æ ·å°±æµªè´¹äº†äººåŠ›æˆæœ¬å’Œæ—¶é—´æˆæœ¬ æ‰€ä»¥redisæ¨å‡ºäº†å“¨å…µæ¨¡å¼ç›¸å½“äºä¸»ä»æ¨¡å¼çš„å‡çº§ç‰ˆã€‚

### 6. redisçš„å“¨å…µæ¨¡å¼ï¼ˆSentinelï¼‰

> å“¨å…µæ¨¡å¼ä¸­ï¼Œé™¤äº†ä¸»ä»æœåŠ¡å™¨å¤–ï¼Œè¿˜å¤šäº†å¾ˆå¤šä¸ªå“¨å…µæœåŠ¡å™¨ï¼Œä¸»è¦ç”¨äºç›‘æ§ä¸»ä»æœåŠ¡å™¨çš„å¯ç”¨æ€§ï¼ˆåº•å±‚æ˜¯å®ƒæ¯éš”ä¸€æ®µæ—¶é—´å‘è¿™äº›æœåŠ¡å™¨å‘é€ä¸€äº›å¿ƒè·³ï¼‰ï¼Œå¦‚æœå‘ç°ä¸»æœåŠ¡å™¨å®•æœºäº†ï¼Œé‚£ä¹ˆè¿™äº›å“¨å…µä¼šæŠ•ç¥¨å†³å®šï¼Œå°†å“ªå°ä»æœåŠ¡å™¨å‡çº§ä¸ºä¸»æœåŠ¡å™¨(æŠ•ç¥¨è¶…è¿‡åŠæ•°æ‰ä¼šå†³å®š)ï¼Œå¥½å¤„åœ¨äºæ— éœ€äººå·¥ä»‹å…¥ã€‚

#### 6.1  è¦å‡ å°å“¨å…µï¼Ÿ

> å‡è®¾:æ­å»ºä¸€å°ä¸»æœåŠ¡ ä¸€å°ä»æœåŠ¡å™¨ éœ€è¦æ­å»ºå‡ ä¸ªå“¨å…µ?
> 		3ä¸ª
> å‡è®¾:æ­å»ºä¸€å°ä¸»æœåŠ¡å™¨ 2å°ä»æœåŠ¡å™¨ éœ€è¦æ­å»ºå‡ ä¸ªå“¨å…µ?
> 		3ä¸ª æˆ–è€…3ä¸ªä»¥ä¸Šéƒ½è¡Œ?å¤§éƒ¨åˆ†éƒ½æ˜¯å¥‡æ•° å› ä¸ºè¦è¶…è¿‡åŠæ•°
>
> ![image-20240911104239546](D:\Desktop\gitee\java-learning\sc240601\Linux\img\éœ€è¦å‡ å°å“¨å…µ.png)

#### 6.2 é…ç½®å“¨å…µ

> * åˆ›å»ºä¸€ä¸ªæ–°ç›®å½•(sentinel)ä¿å­˜å“¨å…µæœåŠ¡å™¨çš„æ‰€æœ‰é…ç½®æ–‡ä»¶(1ä¸»1ä»3å“¨å…µ)
>
> * ä¸»å’Œä»çš„é…ç½®æ–‡ä»¶å’Œä¹‹å‰çš„ä¸»ä»æ¨¡å¼ä¸€è‡´ï¼Œæ²¡æœ‰å˜åŒ–
>
> * é…ç½®å“¨å…µæœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶
>
>   * åˆ é™¤å“¨å…µæœåŠ¡å™¨ä¸éœ€è¦çš„é…ç½®![image-20240911105441309](D:\Desktop\gitee\java-learning\sc240601\Linux\img\åˆ é™¤å“¨å…µæœåŠ¡å™¨ä¸éœ€è¦çš„é…ç½®.png)
>
>   * é…ç½®å“¨å…µçš„é…ç½®æ–‡ä»¶
>
>     ```properties
>     bind 192.168.111.111
>     port 10000
>     daemonize yes
>     pidfile /var/run/redis_10000.pid
>     logfile /usr/local/sc240601/redis-5.0.3/log/redis_10000.log
>     ##å“¨å…µé…ç½®
>     #1. é…ç½®ä¸»ä»ä¿¡æ¯ 
>     #  ä¸»æœåŠ¡å™¨    ä¸»æœåŠ¡å™¨å   ä¸»æœåŠ¡å™¨ip  ä¸»ç«¯å£å·  ä¸»å’Œä»èŠ‚ç‚¹çš„ä¸ªæ•°
>     sentinel monitor mymaster 192.168.111.111 7000 2
>     #2. è®¾ç½®å¤šå°‘ç§’æ˜¯æ²¡æœ‰æ¢å¤ å“¨å…µæ‰è®¤ä¸ºä¸»èŠ‚ç‚¹ä¸‹çº¿(æ¯«ç§’)
>     sentinel down-after-milliseconds mymaster 30000
>     #3.è®¾ç½®æ•…éšœè½¬ç§»æ—¶ æœ€å¤šå¤šå°‘ä¸ªä»æœåŠ¡å™¨åŒæ­¥åˆ°ä¸»æœåŠ¡å™¨
>     sentinel parallel-syncs mymaster 1
>     #4.è®¾ç½®æ•…éšœè½¬ç§»æœ€å¤§å‡çº§
>     sentinel failover-timeout mymaster 60000
>           
>     ```
>
> * é€šè¿‡redisæœåŠ¡ç«¯å‘½ä»¤ å¯åŠ¨ä¸»ä»æœåŠ¡å™¨
>
>   ```
>   redis-server åŒ…/xxx.conf
>   ```
>
> * é€šè¿‡rediså“¨å…µå‘½ä»¤ å¯åŠ¨ä¸‰ä¸ªå“¨å…µæœåŠ¡å™¨
>
>   ```
>   redis-sentinel åŒ…/xxx.conf
>   ```
>
> * æµ‹è¯•ï¼šps -ef | grep redis

#### 6.3 å“¨å…µé…ç½®æ–‡ä»¶çš„è§£æ

>
> æ‚¨æä¾›çš„é…ç½®å†…å®¹åŒ…å«äº† Redis æœåŠ¡å™¨çš„åŸºæœ¬è®¾ç½®å’Œ Redis å“¨å…µï¼ˆSentinelï¼‰çš„é…ç½®ã€‚è§£é‡Šè¿™ä¸¤éƒ¨åˆ†çš„é…ç½®ï¼š
>
> ### Redis æœåŠ¡å™¨é…ç½®
>
> 1. **bind 192.168.111.111**
>    - ç»‘å®š Redis æœåŠ¡å™¨åˆ°æŒ‡å®šçš„ IP åœ°å€ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒRedis æœåŠ¡å™¨å°†åªæ¥å—æ¥è‡ª 192.168.111.111 çš„è¿æ¥ã€‚å¦‚æœæ‚¨å¸Œæœ› Redis æœåŠ¡å™¨èƒ½å¤Ÿæ¥å—æ¥è‡ªå…¶ä»– IP åœ°å€çš„è¿æ¥ï¼Œå¯ä»¥æ·»åŠ æ›´å¤šçš„ IP åœ°å€æˆ–ä½¿ç”¨ `0.0.0.0` æ¥è¡¨ç¤ºæ¥å—æ‰€æœ‰ IP åœ°å€çš„è¿æ¥ã€‚
>
> 2. **port 10000**
>    - è®¾ç½® Redis æœåŠ¡å™¨çš„ç«¯å£å·ä¸º 10000ã€‚å®¢æˆ·ç«¯éœ€è¦é€šè¿‡è¿™ä¸ªç«¯å£æ¥è¿æ¥åˆ° Redis æœåŠ¡å™¨ã€‚
>
> 3. **daemonize yes**
>    - å°† Redis æœåŠ¡å™¨è®¾ç½®ä¸ºå®ˆæŠ¤è¿›ç¨‹æ¨¡å¼è¿è¡Œã€‚è¿™æ„å‘³ç€ Redis æœåŠ¡å™¨å°†åœ¨åå°è¿è¡Œï¼Œå¹¶ä¸”ä¸ä¼šå ç”¨ç»ˆç«¯çª—å£ã€‚
>
> 4. **pidfile /var/run/redis_10000.pid**
>    - æŒ‡å®š Redis æœåŠ¡å™¨çš„è¿›ç¨‹ ID æ–‡ä»¶ï¼ˆPID æ–‡ä»¶ï¼‰çš„è·¯å¾„ã€‚è¿™ä¸ªæ–‡ä»¶åŒ…å«äº† Redis æœåŠ¡å™¨çš„è¿›ç¨‹ IDï¼Œå¯ä»¥ç”¨äºåœæ­¢æˆ–é‡å¯ Redis æœåŠ¡å™¨ã€‚
>
> 5. **logfile /usr/local/sc240601/redis-5.0.3/log/redis_10000.log**
>    - æŒ‡å®š Redis æœåŠ¡å™¨çš„æ—¥å¿—æ–‡ä»¶è·¯å¾„ã€‚Redis æœåŠ¡å™¨ä¼šå°†æ‰€æœ‰çš„æ—¥å¿—ä¿¡æ¯å†™å…¥åˆ°è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œæ–¹ä¾¿æ‚¨è¿›è¡Œæ—¥å¿—åˆ†æå’Œæ•…éšœæ’æŸ¥ã€‚
>
> ### Redis å“¨å…µé…ç½®
>
> 1. **sentinel monitor mymaster 192.168.111.111 7000 2**
>    - é…ç½®å“¨å…µç›‘æ§åä¸º `mymaster` çš„ä¸»æœåŠ¡å™¨ã€‚ä¸»æœåŠ¡å™¨çš„ IP åœ°å€æ˜¯ 192.168.111.111ï¼Œç«¯å£å·æ˜¯ 7000ã€‚`2` è¡¨ç¤ºå“¨å…µéœ€è¦è‡³å°‘æ£€æµ‹åˆ° 2 ä¸ªä»æœåŠ¡å™¨æˆ–å“¨å…µåŒæ„ï¼Œæ‰èƒ½è®¤ä¸ºä¸»æœåŠ¡å™¨ä¸‹çº¿ã€‚
>
> 2. **sentinel down-after-milliseconds mymaster 30000**
>    - è®¾ç½®å“¨å…µåœ¨æ£€æµ‹åˆ°ä¸»æœåŠ¡å™¨ä¸‹çº¿ä¹‹å‰éœ€è¦ç­‰å¾…çš„æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå¦‚æœä¸»æœåŠ¡å™¨åœ¨ 30 ç§’å†…æ²¡æœ‰å“åº”å“¨å…µçš„ ping è¯·æ±‚ï¼Œå“¨å…µå°±ä¼šè®¤ä¸ºä¸»æœåŠ¡å™¨ä¸‹çº¿ã€‚
>
> 3. **sentinel parallel-syncs mymaster 1**
>    - è®¾ç½®åœ¨è¿›è¡Œæ•…éšœè½¬ç§»æ—¶ï¼Œæœ€å¤šå…è®¸å¤šå°‘ä¸ªä»æœåŠ¡å™¨åŒæ—¶åŒæ­¥åˆ°æ–°çš„ä¸»æœåŠ¡å™¨ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåªå…è®¸ 1 ä¸ªä»æœåŠ¡å™¨åŒæ­¥åˆ°æ–°çš„ä¸»æœåŠ¡å™¨ã€‚
>
> 4. **sentinel failover-timeout mymaster 60000**
>    - è®¾ç½®å“¨å…µåœ¨æ‰§è¡Œæ•…éšœè½¬ç§»æ“ä½œæ—¶çš„æœ€å¤§è¶…æ—¶æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå“¨å…µæœ‰ 60 ç§’çš„æ—¶é—´æ¥å®Œæˆæ•…éšœè½¬ç§»æ“ä½œã€‚å¦‚æœåœ¨è§„å®šçš„æ—¶é—´å†…æ²¡æœ‰å®Œæˆæ•…éšœè½¬ç§»ï¼Œå“¨å…µå¯èƒ½ä¼šå†æ¬¡å°è¯•æˆ–æŠ¥å‘Šé”™è¯¯ã€‚
>
> è¯·æ³¨æ„ï¼Œæ‚¨æä¾›çš„é…ç½®ä¸­ Redis æœåŠ¡å™¨å’Œå“¨å…µç›‘æ§çš„ä¸»æœåŠ¡å™¨ä½¿ç”¨äº†ä¸åŒçš„ç«¯å£å·ï¼ˆ10000 å’Œ 7000ï¼‰ã€‚ç¡®ä¿è¿™äº›ç«¯å£å·åœ¨æ‚¨çš„ç½‘ç»œä¸­æ˜¯å¯ç”¨çš„ï¼Œå¹¶ä¸”æ²¡æœ‰ä¸å…¶ä»–æœåŠ¡å†²çªã€‚å¦å¤–ï¼Œå“¨å…µé…ç½®é€šå¸¸éœ€è¦æ”¾ç½®åœ¨å•ç‹¬çš„å“¨å…µé…ç½®æ–‡ä»¶ä¸­ï¼Œè€Œä¸æ˜¯ä¸ Redis æœåŠ¡å™¨çš„é…ç½®æ–‡ä»¶æ··åˆåœ¨ä¸€èµ·ã€‚åœ¨å®é™…éƒ¨ç½²æ—¶ï¼Œè¯·æ ¹æ®æ‚¨çš„å…·ä½“éœ€æ±‚å’Œç¯å¢ƒè¿›è¡Œè°ƒæ•´ã€‚

#### 6.4 æµ‹è¯•å“¨å…µæ¨¡å¼è‡ªåŠ¨åˆ‡æ¢ä¸»æœåŠ¡å™¨

> åœ¨springbooté¡¹ç›®çš„é…ç½®æ–‡ä»¶ä¸­æ·»åŠ ä¾èµ–ï¼š
>
> ```xml
> <!--redis-->
> <!--springbootæ•´åˆredisçš„ä¾èµ–-->
> <dependency>
>     <groupId>org.springframework.boot</groupId>
>     <artifactId>spring-boot-starter-data-redis</artifactId>
> </dependency>
> <!--rediså®¢æˆ·ç«¯ä¾èµ–ï¼Œå•çº¯çš„ssmé¡¹ç›®åªå¯¼å…¥è¿™ä¸ªä¾èµ–å°±èƒ½è¿æ¥redis-->
> <dependency>
>     <groupId>redis.clients</groupId>
>     <artifactId>jedis</artifactId>
> </dependency>
> ```
>
> ç¼–å†™Javaä»£ç è¿æ¥æœåŠ¡å™¨ï¼š
>
> ```java
> package com.sc.sm.testRedis;
> import redis.clients.jedis.Jedis;
> import redis.clients.jedis.JedisSentinelPool;
> import java.util.HashSet;
> import java.util.Set;
> 
> public class TestSentinel {
>     public static void main(String[] args) {
>      //0.å“¨å…µæœåŠ¡å™¨çš„IPåœ°å€:ç«¯å£ çš„seté›†åˆï¼ˆç”¨setæ˜¯ä¸ºäº†å»é‡ï¼‰
>         Set<String> set = new HashSet<>();
>         set.add("192.168.111.111:10000");
>         set.add("192.168.111.111:10001");
>         set.add("192.168.111.111:10002");
>      //1.å®šä¹‰Rediså“¨å…µæ± å¯¹è±¡ï¼ˆå‚æ•°1ï¼šä¸»æœåŠ¡å™¨çš„åå­—åœ¨é…ç½®æ–‡ä»¶ä¸­å®šä¹‰ï¼Œå‚æ•°2ï¼šå“¨å…µçš„åœ°å€seté›†åˆï¼ˆå»é‡ï¼‰
>         JedisSentinelPool pool = new JedisSentinelPool("mymaster", set);
>         
>         int i = 1;
>         while(true) {
>             Jedis jedis = null;//åˆ›å»ºJediså¯¹è±¡(rediså®¢æˆ·ç«¯å¯¹è±¡ï¼‰
>             try {
>                 jedis = pool.getResource();
>                 jedis.set("key-"+i, "value-"+i);
>                 System.out.println("æ’å…¥æ•°æ®æˆåŠŸï¼škey-"+i++);
>                 Thread.sleep(2000);
>             } catch (Exception e) {
>                 System.out.println("å¯èƒ½ä¸»æœåŠ¡å™¨å®•æœºäº†ï¼Œè¯·ç­‰å¾…30ç§’");
>             } finally {
>                 try {
>                     jedis.close();
>                 } catch (Exception e) {
>                     System.out.println("å¯èƒ½ä¸»æœåŠ¡å™¨å®•æœºäº†ï¼Œè¯·ç­‰å¾…30ç§’");
>                 }
>             }
>         }
>     }
> }
> 
> ```
>
> åœ¨linuxä¸­å…³é—­é˜²ç«å¢™æˆ–å¼€å¯ç›¸åº”ç«¯å£å·
>
> ```
> systemctl stop firewalld
> 
> vi /ect/firewalld/zones/public.xml
> <rule family="ipv4">
> 	<port protocol="tcp" port="è¦å¼€æ”¾çš„ç«¯å£å·"/>
> 	<accept/>
> </rule>
> ```
>
> æ€æ­»ä¸»æœåŠ¡å™¨ï¼Œå¯¹æ¯”ä»æœåŠ¡å™¨å‰åçš„èº«ä»½ã€‚
>
> ```
> //æ€æ­»ä¸»æœåŠ¡å™¨
> ps -ef | grep redis
> kill -9 ä¸»æœåŠ¡å™¨è¿›ç¨‹id
> 
> //å¯¹æ¯”ä»æœåŠ¡å™¨çš„å‰åèº«ä»½
> redis-cli -h ä»æœåŠ¡å™¨ip -p ä»æœåŠ¡å™¨ç«¯å£
> info replication
> ```

#### 6.5 å“¨å…µæ¨¡å¼çš„ç¼ºç‚¹

> 1ä¸»(å†™)1ä»(è¯»)3å“¨å…µ(æ£€æµ‹)ï¼Œ6å°æœåŠ¡å™¨ä¸­åªæœ‰1å°æœåŠ¡å™¨åœ¨åšäº‹ã€‚
>
> å“¨å…µæ¨¡å¼åŸºæœ¬å¯ä»¥è§£å†³å¤§éƒ¨åˆ†éœ€æ±‚ï¼Œä½†æ˜¯`åªæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹`ï¼Œæ„å‘³ç€åªæœ‰ä¸€å°æœåŠ¡å™¨å¯ä»¥å†™å…¥ï¼Œå¦‚æœå¹¶å‘é‡ç‰¹åˆ«é«˜æ—¶ï¼Œredisçš„å®¹é‡æ˜¯æ— æ³•æ‰©å®¹çš„(Redisä¸å¥½åœ¨çº¿æ‰©å®¹çš„ï¼Œé›†ç¾¤å®¹é‡ä¸€æ—¦åˆ°è¾¾ä¸Šé™ï¼Œåœ¨çº¿æ‰©å®¹å°±ååˆ†éº»çƒ¦)ï¼Œrediså¹¶å‘é‡ä¸èƒ½å¢é•¿ã€‚æ‰€ä»¥redisæ¨å‡ºäº†é›†ç¾¤æ¨¡å¼ã€‚

### 7. redisçš„é›†ç¾¤æ¨¡å¼ ï¼ˆclusterï¼‰

> é›†ç¾¤æ¨¡å¼æœ€å¤§å¯ä»¥å¢åŠ 1000ä¸ªèŠ‚ç‚¹ï¼ˆæœåŠ¡å™¨ï¼‰ï¼Œè¿™é‡Œé¢å°±å¯ä»¥åŒ…æ‹¬å¤šæ€ä¸»èŠ‚ç‚¹å’Œå¤šå°ä»èŠ‚ç‚¹ã€‚è¿™æ ·redisæ•´ä½“æ€§èƒ½å°±ä¼šéšç€èŠ‚ç‚¹è¶Šå¤šï¼Œæ€§èƒ½è¶Šé«˜ï¼ˆæ”¯æŒæ›´é«˜çš„å¹¶å‘é‡ï¼Œæ”¯æŒæ›´é«˜çš„å®¹é‡ï¼‰

#### 7.1 ä»€ä¹ˆæ˜¯é›†ç¾¤ï¼Ÿ

> redis-clusterä¸»è¦åŒ…å«ä¸‰ä¸ªå†…å®¹ï¼š
>
> * masterï¼šä¸»æœåŠ¡å™¨ï¼ˆä¸»èŠ‚ç‚¹ï¼‰è´Ÿè´£å†™ æ˜¯å¤šä¸ª
> * slaveï¼šä»æœåŠ¡å™¨ï¼ˆä»èŠ‚ç‚¹ï¼‰è´Ÿè´£è¯» ä¼šä¿å­˜ä»çš„å¤‡ä»½ æ˜¯å¤šä¸ª
> * slotï¼šæ•°æ®åˆ†æ§½ï¼ˆæ§½ç‚¹ï¼‰redisä¸€å…±æœ‰16384ä¸ªæ§½ï¼Œæ¯ä¸ªæ§½ç‚¹ç®¡ç†ä¸€éƒ¨åˆ†æ•°æ®ã€‚redisä¼šæ ¹æ®ä¸»èŠ‚ç‚¹çš„æ•°é‡ï¼Œå°†16384æ§½ï¼Œå¹³å‡åˆ†æˆnä¸ªæ•°æ®åˆ†æ§½ã€‚è¿™äº›æ•°æ®åˆ†æ§½ä¼šå¹³å‡åˆ†é…åˆ°æ‰€æœ‰ä¸»èŠ‚ç‚¹ä¸Šã€‚è¿™æ ·æ¯ä¸ªä¸»èŠ‚ç‚¹ç®¡ç†çš„æ•°æ®åˆ†æ§½è¶Šå°‘ï¼Œè¿™æ ·æ•´ä½“çš„æ•°æ®é‡æ˜¯ä¸å˜çš„ï¼Œä½†æ˜¯æ¯ä¸ªä¸»èŠ‚ç‚¹å­˜å‚¨çš„æ•°æ®å’Œå¹¶å‘é‡å°±è¶Šæ¥è¶Šå°‘äº†
> * æ¯”å¦‚:æœ‰ä¸‰ä¸ªä¸»èŠ‚ç‚¹ï¼Œ16384ä¸ªæ§½ä¼šå¹³å‡åˆ†é…ç»™è¿™3å°ä¸»æœåŠ¡å™¨
>   ä¸»èŠ‚ç‚¹Aï¼šç®¡ç†0-5500ä¸ªæ§½ç‚¹  ->  ä»èŠ‚ç‚¹A
>   ä¸»èŠ‚ç‚¹Bï¼šç®¡ç†5501-11000ä¸ªæ§½ç‚¹ ->  ä»èŠ‚ç‚¹B
>   ä¸»èŠ‚ç‚¹cï¼šç®¡ç†11001-16384ä¸ªæ§½ç‚¹ -> ä»èŠ‚ç‚¹C

#### 7.2 é…ç½®é›†ç¾¤

> é›†ç¾¤æ¨¡å¼ä¸‹redisä¼šè‡ªåŠ¨è®¾ç½®ä¸»ä»ï¼Œä¸éœ€è¦å»é…ç½®ä¸»å’Œä»ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦åœ¨ä¸»çš„é…ç½®æ–‡ä»¶çš„åŸºç¡€ä¸Šå¢åŠ ä¸€ä¸ªé›†ç¾¤é…ç½®ï¼Œå°±å®Œæˆäº†é›†ç¾¤èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶ã€‚
>
> - åˆ›å»ºä¸€ä¸ªé›†ç¾¤ç›®å½•(cluster)ä¿å­˜æ‰€æœ‰é›†ç¾¤çš„é…ç½®æ–‡ä»¶
>
> - æ¯ä¸ªèŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶çš„å‰åŠéƒ¨åˆ†éƒ½å’Œä¸»ä»æ¨¡å¼ä¸‹ä¸»èŠ‚ç‚¹çš„é…ç½®ç›¸åŒï¼Œä½†`è¿˜éœ€è¦æ·»åŠ é¢å¤–çš„é›†ç¾¤é…ç½®`
>
>   ```
>   ###é›†ç¾¤é…ç½®
>   #1.å¼€å¯é›†ç¾¤
>   cluster-enabled yes
>   #2.æŒ‡å®šé›†ç¾¤é…ç½®æ–‡ä»¶
>   cluster-config-file nodes-å½“å‰èŠ‚ç‚¹çš„ç«¯å£å·.conf
>   #3.å¦‚æœä¸€ä¸ªä¸»èŠ‚ç‚¹å®•æœºäº† æ²¡æœ‰ä»èŠ‚ç‚¹åšæ•…éšœè½¬ç§» é‚£æ•´ä¸ªé›†ç¾¤æ˜¯å¦å¯å·²ç»§ç»­ä½¿ç”¨çš„é…ç½®
>   cluster-require-full-coverage no
>   ```
>
> ![image-20240911150507609](D:\Desktop\gitee\java-learning\sc240601\Linux\img\é›†ç¾¤ä¸­èŠ‚ç‚¹çš„é…ç½®æ–‡ä»¶.png)

#### 7.3 åˆ›å»ºå¼€å¯é›†ç¾¤çš„è„šæœ¬

> ==æ³¨ï¼šåˆšåˆ›å»ºå¥½çš„è„šæœ¬ä¸€èˆ¬æ˜¯æ²¡æœ‰æ‰§è¡Œæƒé™xçš„ï¼Œæ‰€ä»¥è¦chmod 744 start.sh==
>
> ```sh
> #!/bin/bash
> #ä¸Šé¢è¿™å¥è¡¨ç¤ºè¯¥æ–‡ä»¶æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œçš„è„šæœ¬
> #æ³¨é‡Šç”¨#
> #æ‰“å°ä¸€å¥è¯ä½¿ç”¨echo
> echo 'å¼€å¯redisé›†ç¾¤'
> for i in {7000..7006} #è®¾ç½®å¾ªç¯
> do #å¾ªç¯å¼€å¯
> 	redis-server redis-$i.conf
> 	echo 'redis-'$i'å¯åŠ¨æˆåŠŸ'
> done #å¾ªç¯ç»“æŸ
> echo 'redisé›†ç¾¤å·²ç»å¼€å¯'
>   #åšå¾ªç¯ä½¿ç”¨for i in {7000..7006} do done
>   #ä½¿ç”¨$iæ¥å–å‡ºå˜é‡,å˜é‡ä¸èƒ½å†™åœ¨å­—ç¬¦ä¸²é‡Œé¢ï¼Œç›´æ¥æ‹¼æ¥,è„šæœ¬ä¸­æ²¡æœ‰æ‹¼æ¥ç¬¦
> #å®šä¹‰ä¸€ä¸ªé›†åˆ{7000..7006} å…¶ä¸­..è¡¨ç¤ºèŒƒå›´
> #do-å¾ªç¯å¼€å¯ done-å¾ªç¯ç»“æŸ
> ```

#### 7.4 å¼€å¯è‡ªåŠ¨åˆ†é…æ§½ç‚¹ï¼ˆåªéœ€è¦å¼€å¯ä¸€æ¬¡ï¼Œå“ªæ€•å…³é—­äº†Linuxï¼‰

> æœ€åä¸€ä¸ªé…ç½®ï¼šè®©redisè‡ªåŠ¨åˆ†é…æ§½ç‚¹ è‡ªåŠ¨åˆ›å»ºä¸»ä»èŠ‚ç‚¹ï¼ˆåªéœ€è¦åšä¸€æ¬¡ï¼‰
>
> ```shell
> #æ³¨æ„ä¸‹é¢æ˜¯ä¸€æ¡æŒ‡ä»¤ ä¸å¯ä»¥æ¢è¡Œ
> # --cluster-replicas 1 è¡¨ç¤ºæ¯ä¸ªä¸»èŠ‚ç‚¹ å¯¹åº”1ä¸ªä»èŠ‚ç‚¹
> redis-cli --cluster create 192.168.111.111:7000 192.168.111.111:7001 192.168.111.111:7002 192.168.111.111:7003 192.168.111.111:7004 192.168.111.111:7005 192.168.111.111:7006 --cluster-replicas 1
> ```
>
> ==æ³¨ï¼šè¿è¡Œä¸Šé¢çš„å‘½ä»¤æ—¶ï¼Œå¦‚æœå‡ºç°ç¡®è®¤æç¤ºï¼Œå¿…é¡»è¦è¾“å…¥yesï¼ˆä¸€å®šæ˜¯å°å†™çš„yesï¼‰ï¼Œå¦åˆ™é›†ç¾¤æ§½ç‚¹åˆ†é…å¤±æ•ˆï¼Œå†æ¬¡è¾“å…¥å‘½ä»¤å°±ä¼šå‡ºç°é”™è¯¯ï¼Œå°±ä¼šå‡ºç°ä¸æ˜¯ç©ºçš„é”™è¯¯ï¼Œå› ä¸ºæ§½ç‚¹å·²ç»åˆ†é…è¿‡äº†ã€‚==
>
> é‡åˆ°è¯¥é—®é¢˜çš„è§£å†³æ–¹æ³•ï¼š
>
> * å…ˆå…³é—­é›†ç¾¤æ‰€æœ‰redisæœåŠ¡å™¨ ï¼ˆkill -9 åå¯ä»¥è·Ÿå¤šä¸ªè¿›ç¨‹ï¼‰
>
> * åˆ é™¤redisç›®å½•ä¸‹dataåŒ…ä¸‹çš„æ‰€æœ‰é…ç½®æ–‡ä»¶
>   ![image-20240911154702251](D:\Desktop\gitee\java-learning\sc240601\Linux\img\åˆ é™¤dataåŒ…ä¸‹çš„æ‰€æœ‰æ–‡ä»¶.png)
>
> * é‡å¯æœåŠ¡å™¨ ./å¼€å¯é›†ç¾¤çš„è„šæœ¬
>
> * é‡æ–°æ‰§è¡Œè‡ªåŠ¨åˆ†é…æ§½ç‚¹çš„å‘½ä»¤ï¼Œé‡åˆ°ä¸­é—´çš„æç¤ºè¾“å…¥yes(ä¸€å®šæ˜¯å°å†™çš„yes)
>
>   ä»¥ä¸‹ä¸ºæˆåŠŸçš„ç»“æœï¼š
>   ![image-20240911155054424](D:\Desktop\gitee\java-learning\sc240601\Linux\img\è‡ªåŠ¨åˆ†é…æ§½ç‚¹å‘½ä»¤æˆåŠŸ.png)
>   è¿˜èƒ½åœ¨ä¸Šé¢çš„æç¤ºçœ‹åˆ°é›†ç¾¤çš„å…·ä½“åˆ†é…ä¿¡æ¯ï¼š
>   ![image-20240911155504359](D:\Desktop\gitee\java-learning\sc240601\Linux\img\é›†ç¾¤çš„åŸºæœ¬ä¿¡æ¯1.png)



#### 7.5 æµ‹è¯•é›†ç¾¤çš„è‡ªåŠ¨åˆ†é…

> æµ‹è¯•å‰è¦å¯¼å…¥redisçš„ç›¸å…³ä¾èµ–ã€‚
>
> ```java
> //æµ‹è¯•é›†ç¾¤å¯ç”¨æ€§
> public class TestCluster{
>     public static void main(String[] args) {
>         Set<HostAndPort> set=new HashSet<>();
>         for(int i=7000;i<=7005;i++) {
>             set.add(new HostAndPort("192.168.100.250", i));
>         }
>         //åˆ›å»ºé›†ç¾¤å¯¹è±¡
>         JedisCluster cluster=new JedisCluster(set);
>         int count=1;
>         while(true){
>             try {
>                 cluster.set("key-"+count,"value-"+count);
>                 System.out.println("é›†ç¾¤æ·»åŠ æ•°æ®æˆåŠŸ:key-"+count++);
>                 Thread.sleep(2000);
>             } catch (Exception e) {
>                 System.out.println("ä¸»èŠ‚ç‚¹å¯èƒ½å®•æœºäº† è¯·ç­‰å¾…...");
>             }
>         }
>     }
> }
> ```
>
> æµ‹è¯•æ—¶ä¸èƒ½æ€æ­»å¤ªå¤šèŠ‚ç‚¹ï¼Œè‡³å°‘è¦ç•™3å¯¹ä¸»ä»ï¼Œä¸ç„¶ä¼šä¸€ç›´æŠ›å¼‚å¸¸ã€‚



### 8.springbootæ•´åˆredis

> ä½¿ç”¨: ä¸€èˆ¬æ˜¯åœ¨ä¸šåŠ¡å±‚ä½¿ç”¨ï¼Œç”¨æ¥åšç¼“å­˜ã€‚
> å¯ä»¥ç›´æ¥ä½¿ç”¨RedisTemplateè¿›è¡Œæ‰‹åŠ¨å­˜å‚¨
> å¯ä»¥ä½¿ç”¨redisç›´æ¥æ¥å®ç°ç¼“å­˜åŠŸèƒ½:ä¸æ¨èåˆå­¦è€…ä½¿ç”¨

#### 8.1 å¯¼å…¥ä¾èµ–

> 1.springbootæ•´åˆredisä¾èµ–  2.rediså®¢æˆ·ç«¯

```xml
<!--redis-->
<!--springbootæ•´åˆredisçš„ä¾èµ–-->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
<!--rediså®¢æˆ·ç«¯ä¾èµ–ï¼Œå•çº¯çš„ssmé¡¹ç›®åªå¯¼å…¥è¿™ä¸ªä¾èµ–å°±èƒ½è¿æ¥redis-->
<dependency>
    <groupId>redis.clients</groupId>
    <artifactId>jedis</artifactId>
</dependency>
```

#### 8.2 springbooté…ç½®æ–‡ä»¶ é…ç½®redisé›†ç¾¤

```properties
### redisé…ç½®
#1. é…ç½®redisé›†ç¾¤èŠ‚ç‚¹ ip1:ç«¯å£1,ip2:ç«¯å£2,...
#å¦‚æœåæœŸå¾ˆå¤šèŠ‚ç‚¹ ä¸æ–¹ä¾¿é…ç½® å¯ä»¥é€šè¿‡é…ç½®ç±»å†™å¾ªç¯æ¥å®ç°
#ä½†è¿˜æ˜¯å»ºè®®åœ¨è¿™é‡Œé…ç½®ï¼Œå› ä¸ºipå’Œç«¯å£å¯èƒ½éƒ½æ˜¯æ²¡æœ‰è§„å¾‹çš„ï¼Œæ— æ³•åœ¨é…ç½®ç±»ä¸­å†™å¾ªç¯
spring.redis.cluster.nodes=192.168.111.111:7000,192.168.111.111:7001,192.168.111.111:7002,192.168.111.111:7003,192.168.111.111:7004,192.168.111.111:7005,192.168.111.111:7006
#2. redisè¾…åŠ©é…ç½® éƒ½å¯ä»¥ä¸é…ç½® éƒ½æœ‰é»˜è®¤å€¼
#è¿æ¥æ± æœ€å¤§è¿æ¥æ•° è´Ÿæ•°è¡¨ç¤ºä¸é™åˆ¶
spring.redis.jedis.pool.max-active=-1
#è¿æ¥æ± æœ€å¤§ç­‰å¾…æ—¶é—´
spring.redis.jedis.pool.max-wait=-1ms
#è¿æ¥æ± æœ€å¤§ç©ºé—²è¿æ¥é»˜è®¤å°±æ˜¯8
spring.redis.jedis.pool.max-idle=8
#è¿æ¥æ± æœ€å°ç©ºé—²è¿æ¥ é»˜è®¤å°±æ˜¯0
spring.redis.jedis.pool.min-idle=0
```

#### 8.3 springbootå®šä¹‰redisé…ç½®ç±»RedisConfig

```java
package com.sc.sm.config;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.cache.annotation.CacheConfig;
import org.springframework.cache.annotation.EnableCaching;
import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.data.redis.connection.RedisConnectionFactory;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.data.redis.serializer.GenericJackson2JsonRedisSerializer;
import org.springframework.data.redis.serializer.StringRedisSerializer;

@CacheConfig //ç¼“å­˜é…ç½®
@EnableCaching //å¼€å¯æ³¨è§£ç¼“å­˜
@Configuration
public class RedisConfig {
    @Autowired
    RedisConnectionFactory factory;

    //åªéœ€è¦åˆ›å»ºä¸€ä¸ªbeanå¯¹è±¡RedisTemplate æ“ä½œredisçš„æ ¸å¿ƒå¯¹è±¡
    @Bean
    RedisTemplate<String, Object> redisTemplate() {
        //æŠ¥çº¢æ²¡å…³ç³»ï¼Œå› ä¸ºé…ç½®æ–‡ä»¶å†™äº†é›†ç¾¤èŠ‚ç‚¹åœ°å€
        //æœåŠ¡å™¨å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè¿æ¥å·¥å‚ æ‰€ä»¥springå®¹å™¨ä¼šè‡ªåŠ¨æ³¨å…¥ã€‚ç°åœ¨å› ä¸ºæ²¡æ³¨å…¥æ‰æŠ¥é”™çš„ã€‚
        RedisTemplate<String, Object> rt = new RedisTemplate<>();
        //1.æŒ‡å®škeyåºåˆ—åŒ–æ–¹å¼å­—ç¬¦ä¸² (StringRedisSerializer:redisçš„å­—ç¬¦ä¸²åºåˆ—åŒ–æ–¹å¼ï¼‰
        rt.setKeySerializer(new StringRedisSerializer());
        rt.setHashKeySerializer(new StringRedisSerializer());
        //2.æŒ‡å®švalueåºåˆ—åŒ–æ–¹å¼ json
        rt.setValueSerializer(new GenericJackson2JsonRedisSerializer());
        rt.setHashValueSerializer(new GenericJackson2JsonRedisSerializer());
        //3.è®¾ç½®è¿æ¥å·¥å‚
        rt.setConnectionFactory(factory); //æœåŠ¡å™¨å¯åŠ¨åï¼Œä¼šè‡ªåŠ¨åˆ›å»ºè¿æ¥å·¥å‚ æ‰€ä»¥springå®¹å™¨ä¼šè‡ªåŠ¨æ³¨å…¥ã€‚ç°åœ¨å› ä¸ºæ¯æ³¨å…¥æ‰æŠ¥é”™çš„ã€‚
        return rt;
    }

    //å‡è®¾ ä»¥åèŠ‚ç‚¹æœ‰å¾ˆå¤š ä¸æ–¹ä¾¿å†™é…ç½®æ–‡ä»¶ip:ç«¯å£ï¼Œ å€ŸåŠ©äºé…ç½®ç±»ç›´æ¥æŠŠè¿æ¥å·¥å‚åˆ›å»ºå‡ºæ¥
//    @Bean
//    RedisConnectionFactory factory() {
//        Set<String> nodes = new HashSet<>();
//        for (int i = 7000; i < 7007; i++) {
//            nodes.add("192.168.111.111:"+i);//æ³¨æ„ä¸»æœºåé¢æœ‰ä¸€ä¸ªå†’å·
//        }
//        RedisClusterConfiguration cluster = new RedisClusterConfiguration(nodes);
//        return new JedisConnectionFactory(cluster);
//    }
}


// é…ç½®ç±»åˆ›å»ºé—®é¢˜ï¼š
// 1.é…ç½®ç±»å¾ªç¯å¯¼å…¥redisä¸»æœºæ—¶æ³¨æ„å†’å·: ï¼ˆæŠ¥é”™çœ‹ç¬¬ä¸€ä¸ªæŠ¥é”™çš„ç»“å°¾ï¼Œæˆ–æœ€åä¸€ä¸ªæŠ¥é”™ï¼‰
// 2.Springbooté…ç½®ç±»ä¸­çš„redisçš„é…ç½®å¤šäº†ä¸€ä¸ª.
// 3.é˜²ç«å¢™æ²¡æœ‰å…³é—­å¯¼è‡´è¿æ¥å—é˜»
// 4. RedisConnectionFactory factory; redisè¿æ¥å·¥å‚æ˜¯å†™åœ¨æ–¹æ³•å¤–é¢
```

#### 8.4 ä½¿ç”¨`RedisTemplate`æ¥åšredisç¼“å­˜(Serverå±‚)

> 1. è¿æ¥redisï¼Œåˆ›å»ºrediså¯¹è±¡
>
>    ```java
>    @Autowired //åœ¨é…ç½®ç±»ä¸­åˆ›å»ºredisè¿æ¥å·¥å‚åä¼šè‡ªåŠ¨æ³¨å…¥ã€‚
>    RedisTemplate<String, Object> redis; //è¿æ¥redisï¼Œæ³¨æ„æ˜¯å†™åœ¨æ–¹æ³•å¤–é¢
>    ```
>
> 2. ä½¿ç”¨rediså¯¹è±¡å­˜å‚¨æ•°æ®åˆ°redisæœåŠ¡å™¨ä¸­
>
>    ```java
>    // è®¾ç½®ç®€å•å­—ç¬¦ä¸²å€¼ã€‚
>    redis.opsForValue().set();
>    // æ“ä½œåˆ—è¡¨ã€‚ä½¿ç”¨ leftPushã€rightPush ç­‰æ–¹æ³•ã€‚
>    redis.opsForList().rightPush("myList", "value1"); // ä½¿ç”¨ rightPush åœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´  
>    // å­˜å‚¨æ•°æ®åˆ°å“ˆå¸Œä¸­ã€‚ 
>    redis.opsForHash().put("myHash", "field1", "value1");  
>    // å‘é›†åˆä¸­æ·»åŠ å…ƒç´ ã€‚ 
>    redis.opsForSet().add("mySet", "value1"); 
>    // å‘æœ‰åºé›†åˆä¸­æ·»åŠ å…ƒç´ å¹¶æŒ‡å®šåˆ†æ•°ã€‚ 
>    redis.opsForZSet().add("myZSet", "value1", 1.0); 
>    ```
>
> 3. ä½¿ç”¨redisdå¯¹è±¡è·å–æ•°æ®(æœ‰æ•°æ®å°±ä¸èµ°mysql)
>
>    ```java
>    // è·å–ç®€å•å­—ç¬¦ä¸²å€¼  
>    String myValue = (String) redis.opsForValue().get("myKey");
>          
>    // ä»åˆ—è¡¨ä¸­è·å–æ•°æ®  
>    List<String> myList = redis.opsForList().range("myList", 0, -1); // è·å–æ•´ä¸ªåˆ—è¡¨  
>    String firstElement = redis.opsForList().leftPop("myList");//è·å–å¹¶ç§»é™¤åˆ—è¡¨çš„ç¬¬ä¸€ä¸ªå…ƒç´ 
>          
>    // ä»é›†åˆä¸­è·å–æ•°æ®  
>    Set<String> mySet = redis.opsForSet().members("mySet");
>          
>    // ä»æœ‰åºé›†åˆä¸­è·å–æ•°æ®  
>    Set<String> myZSet = redis.opsForZSet().range("myZSet", 0, -1); // è·å–æ•´ä¸ªæœ‰åºé›†åˆ  
>    Set<ZSetOperations.TypedTuple<String>> myZSetWithScores = redis.opsForZSet().reverseRangeWithScores("myZSet", 0, -1); // è·å–æ•´ä¸ªæœ‰åºé›†åˆåŠå…¶åˆ†æ•°ï¼ŒæŒ‰åˆ†æ•°é™åºæ’åˆ—
>          
>    // ä»å“ˆå¸Œä¸­è·å–æ•°æ®  
>    String value1 = (String) redis.opsForHash().get("myHash", "field1");  
>    Map<Object, Object> allFields = redis.opsForHash().entries("myHash");
>    ```

> åœ¨ Spring Data Redis ä¸­ï¼Œ`RedisTemplate` æä¾›äº†å¤šç§æ“ä½œ Redis æ•°æ®ç»“æ„çš„æ–¹æ³•ã€‚ä½ åˆ—å‡ºçš„æ–¹æ³•å±äºä¸åŒçš„æ“ä½œç±»å‹ï¼Œåˆ†åˆ«ç”¨äºå¤„ç† Redis ä¸­çš„å“ˆå¸Œï¼ˆHashï¼‰ã€åˆ—è¡¨ï¼ˆListï¼‰ã€æœ‰åºé›†åˆï¼ˆZSet æˆ– Sorted Setï¼‰ã€é›†åˆï¼ˆSetï¼‰å’Œç®€å•å­—ç¬¦ä¸²å€¼ï¼ˆValueï¼‰ã€‚ä¸‹é¢æ˜¯æ¯ä¸ªæ–¹æ³•çš„ç®€è¦è¯´æ˜å’Œæ­£ç¡®ä½¿ç”¨æ–¹å¼ï¼š
>
> 1. **`redis.opsForHash().hasKey(key, hashKey)`**
>    - **è¯´æ˜**ï¼šæ£€æŸ¥å“ˆå¸Œä¸­æ˜¯å¦å­˜åœ¨æŒ‡å®šçš„é”®ï¼ˆ`key`ï¼‰å’Œå“ˆå¸Œé”®ï¼ˆ`hashKey`ï¼‰å¯¹åº”çš„å€¼ã€‚
>    - **å‚æ•°**ï¼š
>      - `key`ï¼šRedis ä¸­å“ˆå¸Œçš„é”®ã€‚
>      - `hashKey`ï¼šå“ˆå¸Œä¸­çš„é”®ã€‚
>    - **è¿”å›å€¼**ï¼š`boolean`ï¼Œè¡¨ç¤ºæ˜¯å¦å­˜åœ¨ã€‚
>
> 2. **`redis.opsForList().set(key, index, value)`**
>    - **è¯´æ˜**ï¼šåœ¨åˆ—è¡¨ä¸­æŒ‡å®šç´¢å¼•ä½ç½®è®¾ç½®å€¼ã€‚å¦‚æœç´¢å¼•è¶…å‡ºå½“å‰åˆ—è¡¨çš„é•¿åº¦ï¼Œä¼šåœ¨åˆ—è¡¨æœ«å°¾æ·»åŠ å…ƒç´ ã€‚
>    - **å‚æ•°**ï¼š
>      - `key`ï¼šRedis ä¸­åˆ—è¡¨çš„é”®ã€‚
>      - `index`ï¼šè¦è®¾ç½®çš„ç´¢å¼•ä½ç½®ã€‚
>      - `value`ï¼šè¦è®¾ç½®çš„å€¼ã€‚
>    - **æ³¨æ„**ï¼šè¿™ä¸ªæ–¹æ³•åœ¨è¾ƒæ–°ç‰ˆæœ¬çš„ Spring Data Redis ä¸­å¯èƒ½å·²ç»è¢«å¼ƒç”¨æˆ–æ›´æ”¹ï¼Œå› ä¸º List çš„ `set` æ“ä½œä¸æ˜¯ Redis åŸç”Ÿå‘½ä»¤çš„ç›´æ¥æ˜ å°„ã€‚ä½ å¯èƒ½éœ€è¦ä½¿ç”¨å…¶ä»–æ–¹æ³•ï¼Œå¦‚ `leftPush`ã€`rightPush`ã€`range` ç­‰æ¥æ“ä½œåˆ—è¡¨ã€‚
>
> 3. **`redis.opsForZSet().add(key, value, score)`**
>    - **è¯´æ˜**ï¼šå‘æœ‰åºé›†åˆä¸­æ·»åŠ å…ƒç´ ï¼Œå¹¶æŒ‡å®šå…¶åˆ†æ•°ï¼ˆç”¨äºæ’åºï¼‰ã€‚
>    - **å‚æ•°**ï¼š
>      - `key`ï¼šRedis ä¸­æœ‰åºé›†åˆçš„é”®ã€‚
>      - `value`ï¼šè¦æ·»åŠ çš„å€¼ã€‚
>      - `score`ï¼šä¸å€¼å…³è”çš„åˆ†æ•°ã€‚
>    - **è¿”å›å€¼**ï¼š`boolean`ï¼Œè¡¨ç¤ºæ˜¯å¦æˆåŠŸæ·»åŠ ã€‚
>
> 4. **`redis.opsForSet().add(key, values)`**
>    - **è¯´æ˜**ï¼šå‘é›†åˆä¸­æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªå…ƒç´ ã€‚
>    - **å‚æ•°**ï¼š
>      - `key`ï¼šRedis ä¸­é›†åˆçš„é”®ã€‚
>      - `values`ï¼šè¦æ·»åŠ çš„å€¼ï¼Œå¯ä»¥æ˜¯å•ä¸ªå€¼æˆ–å¤šä¸ªå€¼çš„é›†åˆã€‚
>    - **è¿”å›å€¼**ï¼š`long`ï¼Œè¡¨ç¤ºå®é™…æ·»åŠ çš„å…ƒç´ æ•°é‡ã€‚
>
> 5. **`redis.opsForValue().set(key, value)`**
>    - **è¯´æ˜**ï¼šè®¾ç½®ç®€å•å­—ç¬¦ä¸²å€¼ã€‚
>    - **å‚æ•°**ï¼š
>      - `key`ï¼šRedis ä¸­å­—ç¬¦ä¸²çš„é”®ã€‚
>      - `value`ï¼šè¦è®¾ç½®çš„å€¼ã€‚
>    - **è¿”å›å€¼**ï¼š`void`ï¼Œè¡¨ç¤ºæ“ä½œä¸è¿”å›ç»“æœã€‚
>
> **æ³¨æ„**ï¼š
> - åœ¨ä½¿ç”¨è¿™äº›æ–¹æ³•ä¹‹å‰ï¼Œç¡®ä¿ä½ å·²ç»æ­£ç¡®é…ç½®äº† `RedisTemplate`ï¼ŒåŒ…æ‹¬è¿æ¥å·¥å‚ã€åºåˆ—åŒ–å™¨ç­‰ã€‚
> - Redis çš„æ•°æ®ç±»å‹å’Œæ“ä½œæ˜¯åŒºåˆ†å¤§å°å†™çš„ï¼Œå› æ­¤ç¡®ä¿ä½ çš„é”®å’Œå€¼åœ¨å¤§å°å†™ä¸Šæ˜¯ä¸€è‡´çš„ã€‚
> - å¯¹äº `opsForList().set()` æ–¹æ³•ï¼Œå¦‚æœä½ åœ¨ä½¿ç”¨è¾ƒæ–°ç‰ˆæœ¬çš„ Spring Data Redisï¼Œå¹¶ä¸”å‘ç°è¿™ä¸ªæ–¹æ³•ä¸å¯ç”¨æˆ–è¡Œä¸ºä¸ç¬¦åˆé¢„æœŸï¼Œè¯·æŸ¥é˜…å®˜æ–¹æ–‡æ¡£ä»¥è·å–æœ€æ–°çš„ API è¯´æ˜å’Œä½¿ç”¨æŒ‡å—ã€‚
>
> æœ€åï¼Œè¿™é‡Œæä¾›çš„æ˜¯æ“ä½œ Redis æ•°æ®ç»“æ„çš„åŸºæœ¬æ–¹æ³•ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä½ å¯èƒ½è¿˜éœ€è¦è€ƒè™‘äº‹åŠ¡ã€ç®¡é“ã€å‘å¸ƒ/è®¢é˜…ç­‰é«˜çº§åŠŸèƒ½ã€‚

```java
package com.sc.sm.service.Impl;
import com.github.pagehelper.PageHelper;
import com.github.pagehelper.PageInfo;
import com.sc.sm.mapper.MyuserMapper;
import com.sc.sm.pojo.Myuser;
import com.sc.sm.service.MyUserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.stereotype.Service;
import java.util.Set;

@Service("us1")
public class MyUserServiceImpl implements MyUserService {
    @Autowired
    MyuserMapper mapper;
    @Autowired
    RedisTemplate<String, Object> redis; //è¿æ¥redisï¼Œæ³¨æ„æ˜¯å†™åœ¨æ–¹æ³•å¤–é¢

    @Override
    public int add(Myuser u) {
        //æ‰¹é‡åˆ é™¤rediså¤šä¸ªkeyå€¼ï¼Œé€šè¿‡keyså‘½ä»¤ï¼Œå†™æ­£åˆ™æ¥åŒ¹é…å¤šä¸ªkey
        //æ–°å¢è¦æ›´æ–°åˆ†é¡µä¿¡æ¯ï¼Œæ‰€ä»¥è¦åˆ é™¤æ‰€æœ‰åˆ†é¡µä¿¡æ¯
        redis.delete(redis.keys("user-*")); //è¿™é‡Œåªæ˜¯å‡‘å·§åˆ é™¤äº†ç”¨æˆ·ä¿¡æ¯
        return mapper.insertSelective(u);
    }

    @Override
    public int del(Integer id) {
        redis.delete("user-*");
        return mapper.deleteByPrimaryKey(id);
    }

    //redisæ‰¹é‡åˆ é™¤
    public Long delAll(Integer id) {
        return redis.delete(redis.keys("user-*"));
    }

    @Override
    public Myuser update(Myuser u) {
        // æ›´æ–°å°±æ˜¯åˆ é™¤ï¼Œåˆ å®Œäº†ï¼Œç­‰ç”¨æˆ·é‡æ–°æŸ¥mysqlï¼Œå†å­˜å…¥redisï¼Œå®Œæˆäº†æ›´æ–°
        //æ–°å¢è¦æ›´æ–°åˆ†é¡µä¿¡æ¯ï¼Œæ‰€ä»¥è¦åˆ é™¤æ‰€æœ‰åˆ†é¡µä¿¡æ¯
        // ä¸ºä»€ä¹ˆè¦å…ˆåˆ é™¤åæ›´æ–°ï¼Ÿ
        redis.delete(redis.keys("user-*")); //è¿™é‡Œåªæ˜¯å‡‘å·§åˆ é™¤äº†ç”¨æˆ·ä¿¡æ¯
        mapper.updateByPrimaryKeySelective(u);
        return mapper.selectByPrimaryKey(u.getId());
    }

    //ä½¿ç”¨redisæ¥åšç¼“å­˜
    //1. æŸ¥è¯¢ï¼šç¬¬ä¸€æ¬¡æŸ¥mysql, ä¿å­˜redis, ç¬¬äºŒæ¬¡å°±ç›´æ¥æŸ¥rediså°±å¯ä»¥äº†
    //2. å¢åˆ æ”¹ï¼šè¦æƒ…å†µredisçš„ç¼“å­˜ï¼Œé˜²æ­¢è„è¯»
    public Myuser selectById(Integer id) {
        Myuser user = (Myuser) redis.opsForValue().get("user-"+id);
        if(user==null) { //æŸ¥ä¸åˆ°å°±è¯æ˜æ˜¯ç¬¬ä¸€æ¬¡æŸ¥ï¼Œè¦ä»mysqlä¸­æ¥æŸ¥ï¼ŒæŸ¥å®Œä¿å­˜åˆ°redis
            user  = mapper.selectByPrimaryKey(id);
            System.out.println("æŸ¥è¯¢åˆ°äº†mysql:" + user + "ï¼Œå¹¶ä¸”å­˜å‚¨åˆ°redis");
            redis.opsForValue().set("user-"+id, user);
        }
        return user;
    }

    @Override
    // åˆ†é¡µ + åŠ¨æ€æœç´¢
    public PageInfo<Myuser> selectAll(Integer pageNum, Integer pageSize, Myuser u) {
        PageInfo<Myuser> p = (PageInfo<Myuser>)redis.opsForValue().get("user-"+pageNum+"-"+pageSize);
        System.out.println("å°è¯•ä»redisè·å–åˆ†é¡µæ•°æ®ï¼š" + p);
        //å¦‚æœä»redisè·å–ä¸åˆ°ä¿¡æ¯ï¼Œè¡¨ç¤ºæ²¡æœ‰ç¼“å­˜ï¼Œè¯æ˜æˆ‘ä»¬è¦åœ¨mysqlå…ˆè·å–æ•°æ®å†ä¿å­˜åˆ°redis
        if(p == null) {
            //è®¾ç½®åˆ†é¡µ
            PageHelper.startPage(pageNum, pageSize);
            p = new PageInfo<>(mapper.selectAll(u));
            redis.opsForValue().set("user-"+pageNum+"-"+pageSize, p);
            System.out.println("åœ¨mysqlæŸ¥è¯¢åˆ°äº†åˆ†é¡µä¿¡æ¯:" + p + "ï¼Œå¹¶ä¸”å­˜å‚¨åˆ°redis");
        }
        return p;
    }

    @Override
    public int deleteAll(Integer[] ids) {
        return mapper.deleteAll(ids);
    }
}
```

#### 8.5 ä½¿ç”¨ç¼“å­˜æ³¨è§£æ¥åšredisç¼“å­˜ï¼ˆserverå±‚ï¼‰

> å¯ä»¥ä½¿ç”¨redisæ³¨è§£æ¥å®ç°ç¼“å­˜åŠŸèƒ½: ä¸æ¨èåˆå­¦è€…ä½¿ç”¨ 
>
> * ä½¿ç”¨redisæ³¨è§£å‰æ: é…ç½®ç±»ä¸Šå¿…é¡»æ·»åŠ @Enablecaching å¼€å¯æ³¨è§£ç¼“å­˜
>   ==ä¸ºä»€ä¹ˆæˆ‘ä¸åŠ @Enablecachingä¹Ÿèƒ½ä½¿ç”¨ï¼Ÿ==
> * @Cacheable: ä¸€èˆ¬é’ˆå¯¹äºæŸ»è¯¢æ“ä½œ åº•å±‚åŸç†ç¬¬ä¸€æ¬¡æŸ»mysql æŠŠæ–¹æ³•çš„è¿”å›å€¼å­˜å‚¨åˆ°redis ç¬¬äºŒæ¬¡å†è®¿é—®æ—¶ ä¸æ‰§è¡Œä¸šåŠ¡å±‚æ–¹æ³•(ä¸èµ°mysql)
> * @CacheEvict: æ¸…ç©ºç¼“å­˜çš„æ³¨è§£ ä¸€èˆ¬é€‚ç”¨äºå¢(åˆ ) æ”¹
> * @CachePut: æ›´æ–°ç¼“å­˜çš„æ³¨è§£ ä¸€èˆ¬é€‚ç”¨äºæ›´æ–°ï¼Œredisä¼šæŠŠä¸šåŠ¡å±‚æ–¹æ³•çš„è¿”å›å€¼ æ›´æ–°åˆ°redisä¸­

```java
package com.sc.sm.service.Impl;

import com.github.pagehelper.PageHelper;
import com.github.pagehelper.PageInfo;
import com.sc.sm.mapper.MyuserMapper;
import com.sc.sm.pojo.Myuser;
import com.sc.sm.service.MyUserService;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.cache.annotation.CacheEvict;
import org.springframework.cache.annotation.CachePut;
import org.springframework.cache.annotation.Cacheable;
import org.springframework.data.redis.core.RedisTemplate;
import org.springframework.stereotype.Service;

@Service("us2")
public class MyUserServiceImpl2 implements MyUserService {
    @Autowired
    MyuserMapper mapper;

    @Override
    public int add(Myuser u) {
        return mapper.insertSelective(u);
    }

    @CacheEvict(cacheNames = "user", key = "#id")
    public int del(Integer id) {
        return mapper.deleteByPrimaryKey(id);
    }


    @CachePut(cacheNames = "user", key = "#u.id")
    public Myuser update(Myuser u) {
        mapper.updateByPrimaryKeySelective(u);
        return mapper.selectByPrimaryKey(u.getId());
    }

    //ä½¿ç”¨redisæ³¨è§£æ¥åšç¼“å­˜
    //å¦‚æœä¸åŠ æ³¨è§£å‚æ•°ï¼Œè‡ªåŠ¨ç”Ÿæˆçš„keyçš„åå­—éå¸¸å¤æ‚
    //cacheNames: ç¼“å­˜çš„åå­— é»˜è®¤cacheNames::key  ä½œä¸ºå­˜å‚¨redisçš„key
    //cacheNames: ç¼“å­˜çš„åå­—
    //key: å¯ä»¥éšä¾¿å†™ä¹Ÿå¯ä»¥å†™æ–¹æ³•çš„å‚æ•° #id #u.id
    @Cacheable(cacheNames = "user", key="#id") //ç»“æœä¸ºuser::å½¢å‚idçš„å€¼
    public Myuser selectById(Integer id) {
        System.out.println("æ‰§è¡Œäº†mysql:" + id);
        return mapper.selectByPrimaryKey(id);
    }
}
```









### 9.redisç¼“å­˜é›ªå´© ç©¿é€ å‡»ç©¿---é¢è¯•é¢˜
å¦‚æœä½¿ç”¨redisåšç¼“å­˜ ç”±äºredisçš„ä¸åŒåŸå› (rediså®•æœºäº† ç½‘ç»œå»¶è¿Ÿ keyå¯èƒ½è¶…æ—¶äº†...) éƒ½ä¼šå¯¼è‡´æ— æ³•æ­£å¸¸ä½¿ç”¨ç¼“å­˜ è¿™æ ·å°±ä¼šå‡ºç°ä¸åŒçš„é—®é¢˜

* ç¼“å­˜ç©¿é€:åœ¨è®¿é—®redisä¸­ä¸å­˜åœ¨çš„æ•°æ® æœ€åå°±åªèƒ½è®¿é—®å…³ç³»å‹æ•°æ®åº“æ¯”å¦‚mysqlï¼Œå¦‚æœæ­£å¥½ç”¨æˆ·é‡ç‰¹åˆ«å¤§ è¿™æ ·å…³ç³»å‹æ•°æ®åº“ å‹åŠ›å°±å¾ˆå¤§äº† 
  * è§£å†³æ–¹æ¡ˆ: å¯ä»¥åœ¨redisç¼“å­˜ä¸­å­˜å‚¨ä¸€äº›ç©ºå¯¹è±¡ è¿™äº›ç©ºå¯¹è±¡è¿˜è¦è®¾ç½®æœ‰æ•ˆæœŸã€‚
* ç¼“å­˜å‡»ç©¿: åœ¨åŒä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œè®¿é—®åŒä¸€ä¸ªæ•°æ®æ—¶ï¼Œè¿™æ—¶redisçš„æ•°æ®çªç„¶å°±æ²¡äº†ï¼ˆå¯èƒ½è¢«å…¶ä»–åˆ é™¤äº†ï¼Œå¯èƒ½keyå› ä¸ºè¶…è¿‡æ—¶é—´å¤±æ•ˆäº†ï¼‰è¿™ä¸ªæ—¶é—´ï¼Œè¿™ä¹ˆé«˜çš„å¹¶å‘é‡ï¼Œå°±ä¼šåŒæ—¶è®¿é—®mysqlæ•°æ®åº“ï¼Œé€ æˆå‡»ç©¿ã€‚
  * è§£å†³æ–¹æ¡ˆï¼šè®¾ç½®keyæ°¸ä¸è¿‡æœŸï¼Œæˆ–è€…åŠ é”ï¼Œä¸€ä¸ªçº¿ç¨‹è®¿é—®å…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…...
* ç¼“å­˜é›ªå´©: åœ¨redisè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œç”±äºrediså®•æœºäº†ï¼Œæˆ–è€…redisä¸­æ‰€æœ‰keyé›†ä½“è¿‡æœŸäº†ã€‚
  * è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥æ­å»ºredisé›†ç¾¤ï¼Œå°±ç®—ä¸€å°redisæœåŠ¡å™¨å®•æœºï¼Œè¿˜è¦å…¶ä»–æœåŠ¡å™¨å¯ä»¥ä½¿ç”¨ï¼Œé’ˆå¯¹keyé›†ä½“è¿‡æœŸçš„é—®é¢˜ï¼Œè®¾ç½®ä¸åŒ(éšæœºçš„)çš„è¿‡æœŸæ—¶é—´



### 10.redisæ€»ç»“

>1.ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨redis?  ä»€ä¹ˆæ˜¯redis?   é¡¹ç›®ä¸­ä»€ä¹ˆåŠŸèƒ½ç”¨äº†redis?
>
>2.redisäº”ç§åŸºæœ¬ç±»å‹?
>
>3.redisæ˜¯å¦æ”¯æŒæŒä¹…åŒ–?    RDB å’ŒAOFåŒºåˆ«?   ä¼˜ç¼ºç‚¹?
>
>4.redisä¸»ä»æ¨¡å¼    ä¸»ä»å¤åˆ¶ ?
>
>5.rediså“¨å…µæ¨¡å¼   é›†ç¾¤æ¨¡å¼?
>
>6.redisæ˜¯å¦ä¿è¯åŸå­æ€§ï¼Ÿ
>
>â€‹	ç­”:  redisä¸èƒ½ä¿è¯åŸå­æ€§, å¯ä»¥ä¿è¯rediså•ä¸ªå‘½ä»¤æ‰§è¡Œæ˜¯åŸå­æ€§  
>
>7.redisæ˜¯å¦æ”¯æŒäº‹åŠ¡?
>
>â€‹	ç­”:  redisæœ‰äº‹åŠ¡,  ä½†æ˜¯redisäº‹åŠ¡å¯ä»¥åŒ…å«å¤šæ¬¡æŒ‡ä»¤çš„æ‰§è¡Œ 
>â€‹	äº‹åŠ¡ä¸èƒ½ä¿è¯å¤šæ¬¡æŒ‡ä»¤çš„æ˜¯åŸå­æ€§   redisäº‹åŠ¡æ—¶æ²¡æœ‰å›æ»š
>â€‹	å¦‚æœæœ‰æ¡æŒ‡ä»¤æ‰§è¡Œå¤±è´¥  å…¶ä»–æŒ‡ä»¤ä¾ç„¶å¯ä»¥æ‰§è¡Œ
>â€‹	redisäº‹åŠ¡ä¸»è¦åˆ†ä¸‰ä¸ªé˜¶æ®µ: 1.å¼€å§‹äº‹åŠ¡    2.å‘½ä»¤å…¥è¡Œ   3.æ‰§è¡Œäº‹åŠ¡
>
>8.redisç¼“å­˜ç©¿é€   ç¼“å­˜å‡»ç©¿   ç¼“å­˜é›ªå´© ?  è§£å†³æ–¹æ¡ˆ?
>
>9.é¡¹ç›®ä¸­ä½ æ˜¯å¦‚ä½•ä½¿ç”¨redisçš„?
>
>- redisTemplate     
>- redisæ³¨è§£(@Cacheable  @CachePut  @CacheEvict)
>
>...













